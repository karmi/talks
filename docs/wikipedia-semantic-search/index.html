<!DOCTYPE html>
<html lang="en"><head>
<script src="wikipedia-semantic-search_files/libs/clipboard/clipboard.min.js"></script>
<script src="wikipedia-semantic-search_files/libs/quarto-html/tabby.min.js"></script>
<script src="wikipedia-semantic-search_files/libs/quarto-html/popper.min.js"></script>
<script src="wikipedia-semantic-search_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="wikipedia-semantic-search_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="wikipedia-semantic-search_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="wikipedia-semantic-search_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="wikipedia-semantic-search_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="author" content="Karel Minařík">
  <title>Semantic Search  with  Elasticsearch</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="wikipedia-semantic-search_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="wikipedia-semantic-search_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="wikipedia-semantic-search_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="style.css">
  <link href="wikipedia-semantic-search_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="wikipedia-semantic-search_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="wikipedia-semantic-search_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="wikipedia-semantic-search_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section data-background-color="#000" data-background-image="assets/title-background.jpg" data-background-opacity="0.6" class="quarto-title-block center">
  <h1 class="title">Semantic Search <br>with <br>Elasticsearch</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Karel Minařík 
</div>
</div>
</div>

</section>
<section class="slide level2 center" data-background="#dae5ec">
<h2></h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="assets/qr-link-talk.svg" style="margin-top:-10px;"></p>
</div><div class="column">
<p>This Talk is a Jupyter Notebook</p>
<h3><a href="https://github.com/karmi/talks/blob/main/wikipedia/wikipedia-semantic-search.ipynb" class="underline">github.com/karmi/talks</a></h3>
<p><a href="https://karmi.cz" class="underline">https://karmi.cz</a></p>
</div>
</div>
</section>
<section class="slide level2 text-white center" data-background="#36454F">
<h2>How does a watch work?</h2>

<img data-src="assets/sicario.jpg" class="radius r-stretch"><aside class="notes">
<p>A mechanical and electronic watch both let you “keep an eye on the time”. But inside, they work very differently. Which is similar to semantic and lexical search.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2 center" data-background="#dc143c">
<h2>What Is Semantic Search?</h2>
</section>
<section class="slide level2">
<h2>What Is Semantic Search?</h2>
<ul>
<li><p><strong>Lexical</strong> (<em>“traditional”</em>): terms and frequencies</p></li>
<li><p><strong>Semantic</strong> (<em>“vector”</em>): embeddings and similarity</p></li>
<li><p>“Meaning”, not “words”</p></li>
<li><p>The “vocabulary mismatch” problem</p></li>
<li><p>Other <em>modalities</em> (images, sounds, …) <small><a href="https://karmi.github.io/talks/czpycon2023/#/42"><em>The Library and the Maze</em> (CZ PyCon 2023)</a></small></p></li>
</ul>
<p><small class="pl-1"> → <a href="https://txt.cohere.com/what-is-semantic-search">txt.cohere.com/what-is-semantic-search</a> </small></p>
<div class="footer">
<p>What Is Semantic Search?</p>
</div>
</section>
<section class="slide level2 center" data-background="#dc143c">
<h2>What Are Text Embeddings?</h2>
</section>
<section class="slide level2">
<h2>What Are Text Embeddings?</h2>
<ul>
<li><p>Basic mechanism for natural language processing<br> <small>(LLMs, machine translation, sentiment analysis, …)</small></p></li>
<li><p><strong>Numerical</strong> representations of text content<br> <small>(Words, phrases, sentences, paragraphs, …)</small></p></li>
<li><p>“GPS coordinates” for meaning<br> <small>(Hundreds or thousands of dimensions)</small></p></li>
<li><p>Generated by a pre-trained model</p></li>
</ul>
<p><small class="pl-1"> → <a href="https://www.pinecone.io/learn/vector-embeddings-for-developers/">pinecone.io/learn/vector-embeddings-for-developers</a> </small></p>
<div class="footer">
<p>What Are Text Embeddings?</p>
</div>
<aside class="notes">
<p>The embedding model is like text analyzer in Elasticsearch.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">


<img data-src="assets/scr-projector-tensorflow.png" class="radius r-stretch"><div class="footer">
<p><a href="https://projector.tensorflow.org">projector.tensorflow.org</a></p>
</div>
</section>
<section class="slide level2 center" data-background="#dc143c">
<h2>What is Semantic Similarity?</h2>
</section>
<section class="slide level2 center">
<h2></h2>
<p><span class="math display">\[
\cos(\theta) = \frac{\sum_{i=1}^{n}A_iB_i}{\sqrt{\sum_{i=1}^{n}A_i^2} \cdot \sqrt{\sum_{i=1}^{n}B_i^2}}
\]</span></p>
</section>
<section class="slide level2 center" data-background="black" data-background-image="assets/math-lady.jpg" data-background-transition="fade" data-transition="fade" data-transition-speed="slow">
<h2></h2>
<p><span class="math display">\[
\cos(\theta) = \frac{\sum_{i=1}^{n}A_iB_i}{\sqrt{\sum_{i=1}^{n}A_i^2} \cdot \sqrt{\sum_{i=1}^{n}B_i^2}}
\]</span></p>
</section>
<section class="slide level2">

<ul>
<li><p>Embeddings are just “lists of numbers”</p></li>
<li><p>GPS: <code>[50.0905214, 14.3995431]</code></p></li>
<li><p>Word: <code>[0.0373, 0.0511, -0.0032, 0.0602, …]</code></p></li>
<li><p>Calculate distances <small>(Euclidean distance, dot product similarity, cosine similarity)</small></p></li>
</ul>
<p><small class="pl-1"> → <a href="https://www.pinecone.io/learn/vector-similarity/">pinecone.io/learn/vector-similarity/</a> </small></p>
<div class="footer">
<p>What is Semantic Similarity?</p>
</div>
</section>
<section class="slide level2 slide-code slide-code-wide slide-grey smaller" data-background="#718096">
<h2></h2>
<div class="cell columns column-output-location" data-execution_count="1">
<div class="column">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define three vectors</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> np.array([<span class="dv">6</span>,<span class="dv">7</span>])</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([<span class="dv">8</span>,<span class="dv">9</span>])</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>C <span class="op">=</span> np.array([<span class="dv">2</span>,<span class="dv">10</span>])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack vectors into a single matrix</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>vectors <span class="op">=</span> np.vstack([A, B, C])</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(vectors)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cosine similarity matrix</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>cos_sim_matrix <span class="op">=</span> cosine_similarity(vectors)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate angles in degrees</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>theta_AB <span class="op">=</span> np.arccos(cos_sim_matrix[<span class="dv">0</span>, <span class="dv">1</span>]) <span class="op">*</span> (<span class="dv">180</span> <span class="op">/</span> np.pi)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>theta_AC <span class="op">=</span> np.arccos(cos_sim_matrix[<span class="dv">0</span>, <span class="dv">2</span>]) <span class="op">*</span> (<span class="dv">180</span> <span class="op">/</span> np.pi)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Origin coordinates</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>origin <span class="op">=</span> np.zeros((<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the "quiver" chart</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="fl">12.3</span>))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cosine Similarity For Vectors A, B, C"</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>plt.quiver(origin[:, <span class="dv">0</span>], origin[:, <span class="dv">1</span>], vectors[:, <span class="dv">0</span>], vectors[:, <span class="dv">1</span>],</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>           angles<span class="op">=</span><span class="st">'xy'</span>, scale_units<span class="op">=</span><span class="st">'xy'</span>, scale<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span>[<span class="st">'r'</span>, <span class="st">'g'</span>, <span class="st">'b'</span>])</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="op">-</span><span class="dv">1</span>, <span class="dv">11</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="dv">1</span>, <span class="dv">11</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"X-axis"</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Y-axis"</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>plt.text(A[<span class="dv">0</span>], A[<span class="dv">1</span>], <span class="st">'A'</span>, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>plt.text(B[<span class="dv">0</span>], B[<span class="dv">1</span>], <span class="st">'B'</span>, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>plt.text(C[<span class="dv">0</span>], C[<span class="dv">1</span>], <span class="st">'C'</span>, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>plt.text(A[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">2.5</span>, A[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">2.5</span>, <span class="ss">f'</span><span class="sc">{</span>theta_AB<span class="sc">:.2f}</span><span class="ss">°'</span>, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>plt.text(A[<span class="dv">0</span>] <span class="op">/</span> <span class="fl">2.5</span>, A[<span class="dv">1</span>] <span class="op">/</span> <span class="fl">1.5</span>, <span class="ss">f'</span><span class="sc">{</span>theta_AC<span class="sc">:.2f}</span><span class="ss">°'</span>, color<span class="op">=</span><span class="st">'black'</span>, fontsize<span class="op">=</span><span class="dv">12</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>[[ 6  7]
 [ 8  9]
 [ 2 10]]</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="wikipedia-semantic-search_files/figure-revealjs/cell-2-output-2.png"></p>
</div>
</div>
</div>
</section>
<section class="slide level2 slide-code">
<h2>Generating Embeddings</h2>
<!-- [![](https://huggingface.co/front/assets/huggingface_logo-noborder.svg){class="icon" width="40" height="40"} `paraphrase-multilingual-MiniLM-L12-v2`](https://huggingface.co/sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2) -->
<p><a href="https://huggingface.co/intfloat/multilingual-e5-base"><img data-src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" class="icon" width="40" height="40"> <code>intfloat/multilingual-e5-base</code></a></p>

<div class="cell" data-execution_count="240">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>MODEL_ID <span class="op">=</span> <span class="st">"intfloat/multilingual-e5-base"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SentenceTransformer(MODEL_ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="252">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>word_emb <span class="op">=</span> model.encode(<span class="st">"clock"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.printoptions(linewidth<span class="op">=</span><span class="dv">100</span>, threshold<span class="op">=</span><span class="dv">100</span>): <span class="bu">print</span>(word_emb)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(word_emb.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[-0.01488969  0.03256331 -0.00374006 ...  0.01093324 -0.03524447  0.03797634]
(768,)</code></pre>
</div>
</div>
<aside><div>
<p><a href="https://hf.co/spaces/mteb/leaderboard">hf.co/spaces/mteb/leaderboard</a></p>
</div></aside></section>
<section class="slide level2 slide-code smaller">
<h2>Generate Embeddings for Multiple Words</h2>
<p><a href="https://www.sbert.net/docs/package_reference/SentenceTransformer.html#sentence_transformers.SentenceTransformer.encode"><code>sentence_transformers.SentenceTransformer.encode</code></a></p>
<div class="cell" data-execution_count="515">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>QUERY_PREFIX   <span class="op">=</span> <span class="st">"query: "</span>   <span class="cf">if</span> <span class="st">"e5"</span> <span class="kw">in</span> MODEL_ID <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>PASSAGE_PREFIX <span class="op">=</span> <span class="st">"passage: "</span> <span class="cf">if</span> <span class="st">"e5"</span> <span class="kw">in</span> MODEL_ID <span class="cf">else</span> <span class="st">""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="524">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>words <span class="op">=</span> [<span class="st">"cat"</span>, <span class="st">"mouse"</span>, <span class="st">"house"</span>, <span class="st">"kitten"</span>, <span class="st">"clock"</span>]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    [  [model.encode(PASSAGE_PREFIX <span class="op">+</span> word)] <span class="cf">for</span> word <span class="kw">in</span> words ],</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>words, columns<span class="op">=</span>[<span class="st">"embeddings"</span>])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="524">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">embeddings</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">cat</td>
<td>[0.021156617, -0.00069385127, -0.015012221, 0....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mouse</td>
<td>[0.0007892736, 0.012299454, -0.0062992857, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">house</td>
<td>[0.016028672, 0.01198161, -0.019900559, 0.0164...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">kitten</td>
<td>[0.018304918, -0.010472597, -0.0055162413, 0.0...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">clock</td>
<td>[-0.0146252755, 0.016221017, -0.012604436, 0.0...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Compute Cosine Similarity</h2>
<p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.cosine_similarity.html"><code>sklearn.metrics.pairwise.cosine_similarity</code></a></p>
<p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html"><code>sklearn.preprocessing.MinMaxScaler</code></a></p>
<div class="cell columns column-output-location" data-execution_count="1433">
<div class="column">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>query <span class="op">=</span> <span class="st">"cat"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>query_emb <span class="op">=</span> model.encode(QUERY_PREFIX <span class="op">+</span> query)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>similarities <span class="op">=</span> {}</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute similarities</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics.pairwise <span class="im">import</span> cosine_similarity</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> word, word_emb <span class="kw">in</span> df[<span class="st">"embeddings"</span>].items():</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    similarities[word] <span class="op">=</span> cosine_similarity(</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        [query_emb],</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        [word_emb]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      )[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Original similarities</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> <span class="bu">list</span>(similarities.values())</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalized similarities</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> MinMaxScaler()</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>normalized_scores <span class="op">=</span> <span class="op">\</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    scaler.fit_transform(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        np.array(scores).reshape(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)).flatten()</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame({</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Word"</span>: [<span class="ss">f"</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss"> ⇔ </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k <span class="kw">in</span> similarities.keys()],</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Similarity"</span>: similarities.values(),</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  .sort_values(by<span class="op">=</span>[<span class="st">"Similarity"</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  .style</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    .hide(axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(precision<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    .set_caption(<span class="st">"Original"</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    .set_table_attributes(<span class="st">'class="dataframe small"'</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    .bar(subset<span class="op">=</span>[<span class="st">'Similarity'</span>], color<span class="op">=</span><span class="st">'#999'</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>display(</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame({</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Word"</span>: [<span class="ss">f"</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss"> ⇔ </span><span class="sc">{</span>k<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> k <span class="kw">in</span> similarities.keys()],</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Similarity"</span>: normalized_scores,</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  .sort_values(by<span class="op">=</span>[<span class="st">"Similarity"</span>], ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  .style</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    .hide(axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">format</span>(precision<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    .set_caption(<span class="st">"Normalized"</span>)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    .set_table_attributes(<span class="st">'class="dataframe small"'</span>)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    .bar(subset<span class="op">=</span>[<span class="st">'Similarity'</span>], color<span class="op">=</span><span class="st">'#999'</span>)</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display">
<style type="text/css">
#T_c6bb8_row0_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 100.0%, transparent 100.0%);
}
#T_c6bb8_row1_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 97.1%, transparent 97.1%);
}
#T_c6bb8_row2_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 92.6%, transparent 92.6%);
}
#T_c6bb8_row3_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 90.0%, transparent 90.0%);
}
#T_c6bb8_row4_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 89.1%, transparent 89.1%);
}
</style>

<table id="T_c6bb8" class="dataframe small" data-quarto-postprocess="true">
<caption>Original</caption>
<thead>
<tr class="header">
<th id="T_c6bb8_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Word</th>
<th id="T_c6bb8_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_c6bb8_row0_col0" class="data row0 col0">cat ⇔ cat</td>
<td id="T_c6bb8_row0_col1" class="data row0 col1">0.8910</td>
</tr>
<tr class="even">
<td id="T_c6bb8_row1_col0" class="data row1 col0">cat ⇔ kitten</td>
<td id="T_c6bb8_row1_col1" class="data row1 col1">0.8655</td>
</tr>
<tr class="odd">
<td id="T_c6bb8_row2_col0" class="data row2 col0">cat ⇔ mouse</td>
<td id="T_c6bb8_row2_col1" class="data row2 col1">0.8249</td>
</tr>
<tr class="even">
<td id="T_c6bb8_row3_col0" class="data row3 col0">cat ⇔ house</td>
<td id="T_c6bb8_row3_col1" class="data row3 col1">0.8015</td>
</tr>
<tr class="odd">
<td id="T_c6bb8_row4_col0" class="data row4 col0">cat ⇔ clock</td>
<td id="T_c6bb8_row4_col1" class="data row4 col1">0.7940</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<style type="text/css">
#T_faa11_row0_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 100.0%, transparent 100.0%);
}
#T_faa11_row1_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 73.8%, transparent 73.8%);
}
#T_faa11_row2_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 31.9%, transparent 31.9%);
}
#T_faa11_row3_col1 {
  width: 10em;
  background: linear-gradient(90deg, #999 7.8%, transparent 7.8%);
}
#T_faa11_row4_col1 {
  width: 10em;
}
</style>

<table id="T_faa11" class="dataframe small" data-quarto-postprocess="true">
<caption>Normalized</caption>
<thead>
<tr class="header">
<th id="T_faa11_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">Word</th>
<th id="T_faa11_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Similarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_faa11_row0_col0" class="data row0 col0">cat ⇔ cat</td>
<td id="T_faa11_row0_col1" class="data row0 col1">1.0000</td>
</tr>
<tr class="even">
<td id="T_faa11_row1_col0" class="data row1 col0">cat ⇔ kitten</td>
<td id="T_faa11_row1_col1" class="data row1 col1">0.7378</td>
</tr>
<tr class="odd">
<td id="T_faa11_row2_col0" class="data row2 col0">cat ⇔ mouse</td>
<td id="T_faa11_row2_col1" class="data row2 col1">0.3186</td>
</tr>
<tr class="even">
<td id="T_faa11_row3_col0" class="data row3 col0">cat ⇔ house</td>
<td id="T_faa11_row3_col1" class="data row3 col1">0.0781</td>
</tr>
<tr class="odd">
<td id="T_faa11_row4_col0" class="data row4 col0">cat ⇔ clock</td>
<td id="T_faa11_row4_col1" class="data row4 col1">0.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section class="slide level2" data-background="#101C3F">
<h2></h2>
<p><br><br> <img data-src="assets/logo-elastic-glyph-color.svg" height="300"> <br><br></p>
<section class="aside">
<h3>You Know, for Search!</h3>
</section>
</section>
<section class="slide level2" data-background="#36454F">
<h2>The Workflow</h2>
<ol type="1">
<li>Pre-process the data</li>
<li>Generate embeddings</li>
<li>Index embeddings</li>
<li>Search the data</li>
<li>Evaluate search quality</li>
</ol>
</section>
<section class="slide level2" data-background="#36454F">
<h2>The Outcome</h2>
<iframe id="word-arithmetics" src="http://127.0.0.1:5000/?q=Jak+fungují+hodinky%3F&amp;m=e5-base&amp;t=semantic" width="100%" height="85%">
</iframe>
</section>
<section class="slide level2 slide-code">
<h2><a href="https://huggingface.co/datasets/wikimedia/wikipedia/viewer/20231101.cs"><img data-src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" class="icon" width="40" height="40"> <code>wikimedia/wikipedia</code></a></h2>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datasets</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> datasets.load_dataset(<span class="st">"wikimedia/wikipedia"</span>, name<span class="op">=</span><span class="st">"20231101.cs"</span>, split<span class="op">=</span><span class="st">"train"</span>, revision<span class="op">=</span><span class="st">"b04c8d1"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>ds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Dataset({
    features: ['id', 'url', 'title', 'text'],
    num_rows: 534044
})</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">"display.max_colwidth"</span>, <span class="dv">104</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  display(pd.DataFrame.from_dict(ds[<span class="dv">1</span>:<span class="dv">2</span>])[[<span class="st">"title"</span>, <span class="st">"text"</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table class="dataframe" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header" style="text-align: right;">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Astronomie</td>
<td>Astronomie, řecky αστρονομία z άστρον (astron) hvězda a νόμος (nomos) zákon, česky též hvězdářství, ...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section class="slide level2">
<h2>Pre-process the Data</h2>
<ul>
<li>Assumption: the data is text-based</li>
<li>Split the text into semantic units (“chunks”)</li>
<li>Chapters, paragraphs, sentences, …</li>
<li>Limited by the model context window</li>
</ul>
<div class="cell" data-execution_count="1259">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Context limit: </span><span class="sc">{</span>model<span class="sc">.</span>max_seq_length<span class="sc">}</span><span class="ss"> tokens"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Context limit: 512 tokens</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ds[<span class="dv">1</span>][<span class="st">"text"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Astronomie, řecky αστρονομία z άστρον (astron) hvězda a νόμος (nomos) zákon, česky též hvězdářství, je věda, která se zabývá jevy za hranicemi zemské atmosféry. Zvláště tedy výzkumem vesmírných těles, jejich soustav, různých dějů ve vesmíru i vesmírem jako celkem.

Historie astronomie

Antika 
Astronomie se podobně jako další vědy začala rozvíjet ve starověku. Na území Babylonie však nebylo k popisu používáno již vynalezené geometrie (grafy). První se z astronomie rozvíjela astrometrie, zabývající se měřením poloh hvězd a planet na obloze. Tato oblast astronomie měla velký význam pro navigaci. Podstatnou částí astrometrie je sférická astronomie sloužící k popisu poloh objektů na nebeské sféře, zavádí souřadnice a popisuje významné křivky a body na nebeské sféře. Pojmy ze sférické astronomie se také používají při měření času.

Další oblastí astronomie, která se rozvinula, byla nebeská mechanika. Zabývá se pohybem těles v gravitačním poli, například planet ve sluneční soustavě. Základem nebeské mechaniky jsou práce Keplera a Newtona.

Aristotelés ve svém díle O nebi z roku 340 př. n. l. dokázal, že tvar Země musí být kulatý, jelikož stín Země na Měsíci je při zatmění vždy kulatý, což by při plochém tvaru Země nebylo možné. Řekové také zjistili, že pokud sledujeme Polárku z jižnějšího místa na Zemi, jeví se nám níže nad obzorem než pro pozorovatele ze severu, kterému se bude její poloha na obloze jevit výše. Aristotelés dále určil poloměr Země, který ale odhadl na dvojnásobek skutečného poloměru. V aristotelovském modelu Země stojí Měsíc se Sluncem a hvězdami krouží kolem ní, a to po kruhových drahách.
 
Myšlenky Aristotelovy rozvinul ve 2. století našeho letopočtu Klaudios Ptolemaios, který také stavěl Zemi do středu a další objekty nechal obíhat kolem ní ve sférách:
 první byla sféra Měsíce,
 dále sféry sluneční soustavy – Slunce a planet : Merkuru, Venuše, Marsu, Jupitera, Saturna a
 sféra stálic – hvězd, jež byly považovány za nehybné, jak to plyne z názvu, měly se pohybovat jen společně s oblohou. Tento model dostatečně vyhovoval polohám těles na obloze.

Novověk 
Roku 1514 navrhl Mikuláš Koperník nový model, ve kterém bylo ve středu soustavy Slunce a planety obíhaly kolem něj po kruhových drahách, setkal se ale s problémy při pozorováních, objekty se nenacházely na správných souřadnicích.

Roku 1609 zkonstruoval Galileo Galilei dalekohled, s jehož pomocí objevil čtyři měsíce obíhající kolem planety Jupiter, a tím dokázal Koperníkovu teorii o Slunci ve středu a planetách kroužících kolem.

Johannes Kepler zaměnil kruhové dráhy planet za eliptické, čímž bylo dosaženo souladu s pozorovanými polohami těles.

V roce 1687 vydal sir Isaac Newton knihu Philosophiae Naturalis Principia Mathematica o poloze těles v prostoru a čase a zákon obecné přitažlivosti, podle něhož jsou k sobě tělesa vázána gravitací, která závisí na hmotnosti těles a na jejich vzdálenosti. Z gravitačního zákona vychází eliptický pohyb planet.

Nová doba 
Roku 1929 studoval Edwin Hubble daleké galaxie, zjistil rudý posuv, který se zvětšuje se vzdáleností, to byl důkaz o rozpínání vesmíru. Fakt, že se od sebe objekty vzdalují, naznačuje, že někdy v minulosti byly objekty velmi blízko od sebe, tím se zrodily myšlenky o velkém třesku, místě a čase, kdy byl vesmír nekonečně malý a hustý.

V letech 1905–1915 napsal Albert Einstein teorii relativity – speciální, ve které zavedl konečnou rychlost světla a obecnou relativitu o gravitaci, čase a prostoru ve velkých rozměrech. Na začátku 20. století vznikla kvantová teorie o chování elementárních částic.

Čínská astronomie 

Čínská astronomie má velice dlouhou historii a dějepisci považují Číňany za „nejdůslednější a nejpřesnější pozorovatele nebeských jevů na světě před Araby.“ Jména hvězd později rozdělili do 28 kategorií („panství“, [říší]) v dobách dynastie Šang (Shang) v čínské době bronzové a zřejmě se zformovaly za vlády Wu-Tinga (Wu Ding) (1339–1281 př. n. l.).

Podrobné záznamy astrologických pozorování započaly v éře válek kolem 4. století př. n. l. a vzkvétaly dále od období dynastie Chan. Čínská astronomie byla rovníková soustředěná na podrobná pozorování hvězd z okolí pólu a byla založená na jiných principech než převládaly v západoevropské astronomii, kde východ a západ slunce zodiakálních souhvězdí tvořil základní ekliptický rámec.

Některé prvky indické astronomie se dostaly do Číny při expanzi buddhismu po dynastii Chan (25–220 n.l.), ale nejpodrobnější vtělení indické astronomie nastalo za dynastie Tchang (Tang, 618–907), kdy mnozí indičtí astronomové přesídlili do čínského hlavního města a čínští učenci, jako velký tantrický buddhistický mnich a matematik Ji-Šing (Yi Xing) propracoval její systém. Astronomie islámského středověku úzce spolupracovala se svými čínskými kolegy během dynastie Juan (Yuan) a po období poměrného ústupu za dynastie Ming astronomie ožila podněty západní kosmologie a techniky po vzniku jezuitských misií. Dalekohled byl zaveden v 17. století. V roce 1669 byla pekingská observatoř přestavěna pod vedením Ferdinanda Verbiesta. Dnešní Čína pokračuje v astronomických aktivitách s mnoha hvězdárnami a vlastním vesmírným programem.

Části astronomie 
Od novověku do současnosti se astronomie nesmírně rozšířila a vznikla celá řada nových oblastí výzkumu, které lze velmi zhruba rozdělit na pozorování a teorii, nebo podle objektu zájmu.

Astronomické pozorování 
Astronom, česky hvězdář, se zabývá zkoumáním vesmíru. Kromě profesionálních astronomů se astronomii věnuje i řada astronomů amatérských.

Nejvýznamnějším zdrojem informací o vesmíru je elektromagnetické záření. Část jeho vlnových délek, vnímatelná očima, je světlo. Obory astronomického pozorování podle využívaných vlnových délek jsou

 gama astronomie
 rentgenová astronomie
 ultrafialová astronomie
 optická astronomie
 infračervená astronomie
 mikrovlnná astronomie
 radioastronomie

Nejstarší a nejdůležitější je optická astronomie, využívající světlo. Rozvoj dalších oborů souvisel s vývojem techniky. Například radioastronomie se začala rozvíjet ve 30. letech 20. století, kdy Karl Guthe Jansky při zkoumání zdrojů šumu rušících rádiové hovory objevil rádiové emise centra naší Galaxie. Atmosféra Země mnoho vlnových délek účinně pohlcuje, takže gama a rentgenové pozorování se mohlo konat jen pomocí stratosférických balónů a výrazný rozvoj se dostavil teprve s pokrokem kosmonautiky.

Ještě exotičtější je pozorování jiných částic než elektromagnetického záření.
 neutrinová astronomie pozoruje neutrina, teleskopy jsou v současnosti velké prostory hluboko pod zemí, zaplněné vodou nebo jiným pozorovacím médiem
 studium kosmického záření, vysokoenergetických částic mimozemského původu. Využívá metod jaderné fyziky (v kosmickém záření se vyskytují i částice s o mnoho řádů větší energií než jaká je dosažitelná na urychlovačích).

Hypotetická gravitační astronomie by měla pozorovat gravitační vlny. V současnosti jsou převažujícím způsobem detekce velké interferometry. První pozorování gravitačních vln proběhlo&nbsp;14. září&nbsp;2015 na americkém detektoru&nbsp;LIGO, i když nepřímé důkazy byly předloženy již dříve.

Astronomická teorie 
Obecným teoretickým oborem je astrofyzika. Zabývá se fyzikou hvězd a mezihvězdné hmoty (hustotou, teplotou, chemickým složením atd.).

Kosmologie studuje vesmír jako celek a zvláště jeho vznik, současný a budoucí vývoj.

Astrobiologie se zabývá možnostmi existence života ve vesmíru.

Astronomie podle objektu zájmu 
 Hvězdná astronomie se zabývá hvězdami, včetně Slunce; výzkumem prostorového rozložení a zákonitostmi pohybů hvězd a hvězdných soustav.
Podle metody výzkumu se dělí na: 1. stelární statistiku, 2. stelární kinematiku, 3. stelární dynamiku
 Galaktická astronomie se zabývá zkoumáním struktury, součástí a vývoje galaxií – v prvé řadě naší Galaxie.
 Extragalaktická astronomie zkoumá objekty za hranicemi naší Galaxie.
 Planetární vědy zkoumají planety v naší sluneční soustavě. Řadí se do astronomie, ale jejich části mají často užší spojitost s odpovídajícími vědami o planetě Zemi (například geologie Marsu).
 Meteorická astronomie se zabývá studiem pohybu a dalšími vlastnostmi meteorů a meteoritů.

Vztah astronomie k dalším vědám 
Astronomie má nejužší vztah s fyzikou. Astronomická teorie je v podstatě fyzika astronomických systémů. Naopak astronomické systémy jsou pro velkou část fyzikální teorie nejdůležitější „laboratoří“, přirozeně především ve velkých prostorových a časových měřítkách se projevuje gravitace a testuje obecná teorie relativity. Ve vesmíru se vyskytují i extrémní podmínky, které nejsou zatím dosažitelné v laboratořích, například tlak, hustota, teplota, magnetické pole a další.

Významný vztah má astronomie i k religionistice.

Odkazy

Reference

Související články 
 Astrofyzika
 Astronomický ústav AV
 Hvězda
 Planeta
 Sluneční soustava
 Souhvězdí
 Vesmír

Externí odkazy 
 
 
 
 
 

 
Přírodní vědy
Sedm svobodných umění</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code">
<h2>Split Text to Paragraphs</h2>
<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_to_paraghraps(text):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> text.split(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="802">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paragraph <span class="kw">in</span> split_to_paraghraps(ds[<span class="dv">1</span>][<span class="st">"text"</span>]):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(paragraph)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"━━━━━"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Astronomie, řecky αστρονομία z άστρον (astron) hvězda a νόμος (nomos) zákon, česky též hvězdářství, je věda, která se zabývá jevy za hranicemi zemské atmosféry. Zvláště tedy výzkumem vesmírných těles, jejich soustav, různých dějů ve vesmíru i vesmírem jako celkem.
━━━━━
Historie astronomie
━━━━━
Antika 
Astronomie se podobně jako další vědy začala rozvíjet ve starověku. Na území Babylonie však nebylo k popisu používáno již vynalezené geometrie (grafy). První se z astronomie rozvíjela astrometrie, zabývající se měřením poloh hvězd a planet na obloze. Tato oblast astronomie měla velký význam pro navigaci. Podstatnou částí astrometrie je sférická astronomie sloužící k popisu poloh objektů na nebeské sféře, zavádí souřadnice a popisuje významné křivky a body na nebeské sféře. Pojmy ze sférické astronomie se také používají při měření času.
━━━━━
Další oblastí astronomie, která se rozvinula, byla nebeská mechanika. Zabývá se pohybem těles v gravitačním poli, například planet ve sluneční soustavě. Základem nebeské mechaniky jsou práce Keplera a Newtona.
━━━━━
Aristotelés ve svém díle O nebi z roku 340 př. n. l. dokázal, že tvar Země musí být kulatý, jelikož stín Země na Měsíci je při zatmění vždy kulatý, což by při plochém tvaru Země nebylo možné. Řekové také zjistili, že pokud sledujeme Polárku z jižnějšího místa na Zemi, jeví se nám níže nad obzorem než pro pozorovatele ze severu, kterému se bude její poloha na obloze jevit výše. Aristotelés dále určil poloměr Země, který ale odhadl na dvojnásobek skutečného poloměru. V aristotelovském modelu Země stojí Měsíc se Sluncem a hvězdami krouží kolem ní, a to po kruhových drahách.
 
Myšlenky Aristotelovy rozvinul ve 2. století našeho letopočtu Klaudios Ptolemaios, který také stavěl Zemi do středu a další objekty nechal obíhat kolem ní ve sférách:
 první byla sféra Měsíce,
 dále sféry sluneční soustavy – Slunce a planet : Merkuru, Venuše, Marsu, Jupitera, Saturna a
 sféra stálic – hvězd, jež byly považovány za nehybné, jak to plyne z názvu, měly se pohybovat jen společně s oblohou. Tento model dostatečně vyhovoval polohám těles na obloze.
━━━━━
Novověk 
Roku 1514 navrhl Mikuláš Koperník nový model, ve kterém bylo ve středu soustavy Slunce a planety obíhaly kolem něj po kruhových drahách, setkal se ale s problémy při pozorováních, objekty se nenacházely na správných souřadnicích.
━━━━━
Roku 1609 zkonstruoval Galileo Galilei dalekohled, s jehož pomocí objevil čtyři měsíce obíhající kolem planety Jupiter, a tím dokázal Koperníkovu teorii o Slunci ve středu a planetách kroužících kolem.
━━━━━
Johannes Kepler zaměnil kruhové dráhy planet za eliptické, čímž bylo dosaženo souladu s pozorovanými polohami těles.
━━━━━
V roce 1687 vydal sir Isaac Newton knihu Philosophiae Naturalis Principia Mathematica o poloze těles v prostoru a čase a zákon obecné přitažlivosti, podle něhož jsou k sobě tělesa vázána gravitací, která závisí na hmotnosti těles a na jejich vzdálenosti. Z gravitačního zákona vychází eliptický pohyb planet.
━━━━━
Nová doba 
Roku 1929 studoval Edwin Hubble daleké galaxie, zjistil rudý posuv, který se zvětšuje se vzdáleností, to byl důkaz o rozpínání vesmíru. Fakt, že se od sebe objekty vzdalují, naznačuje, že někdy v minulosti byly objekty velmi blízko od sebe, tím se zrodily myšlenky o velkém třesku, místě a čase, kdy byl vesmír nekonečně malý a hustý.
━━━━━
V letech 1905–1915 napsal Albert Einstein teorii relativity – speciální, ve které zavedl konečnou rychlost světla a obecnou relativitu o gravitaci, čase a prostoru ve velkých rozměrech. Na začátku 20. století vznikla kvantová teorie o chování elementárních částic.
━━━━━
Čínská astronomie 
━━━━━
Čínská astronomie má velice dlouhou historii a dějepisci považují Číňany za „nejdůslednější a nejpřesnější pozorovatele nebeských jevů na světě před Araby.“ Jména hvězd později rozdělili do 28 kategorií („panství“, [říší]) v dobách dynastie Šang (Shang) v čínské době bronzové a zřejmě se zformovaly za vlády Wu-Tinga (Wu Ding) (1339–1281 př. n. l.).
━━━━━
Podrobné záznamy astrologických pozorování započaly v éře válek kolem 4. století př. n. l. a vzkvétaly dále od období dynastie Chan. Čínská astronomie byla rovníková soustředěná na podrobná pozorování hvězd z okolí pólu a byla založená na jiných principech než převládaly v západoevropské astronomii, kde východ a západ slunce zodiakálních souhvězdí tvořil základní ekliptický rámec.
━━━━━
Některé prvky indické astronomie se dostaly do Číny při expanzi buddhismu po dynastii Chan (25–220 n.l.), ale nejpodrobnější vtělení indické astronomie nastalo za dynastie Tchang (Tang, 618–907), kdy mnozí indičtí astronomové přesídlili do čínského hlavního města a čínští učenci, jako velký tantrický buddhistický mnich a matematik Ji-Šing (Yi Xing) propracoval její systém. Astronomie islámského středověku úzce spolupracovala se svými čínskými kolegy během dynastie Juan (Yuan) a po období poměrného ústupu za dynastie Ming astronomie ožila podněty západní kosmologie a techniky po vzniku jezuitských misií. Dalekohled byl zaveden v 17. století. V roce 1669 byla pekingská observatoř přestavěna pod vedením Ferdinanda Verbiesta. Dnešní Čína pokračuje v astronomických aktivitách s mnoha hvězdárnami a vlastním vesmírným programem.
━━━━━
Části astronomie 
Od novověku do současnosti se astronomie nesmírně rozšířila a vznikla celá řada nových oblastí výzkumu, které lze velmi zhruba rozdělit na pozorování a teorii, nebo podle objektu zájmu.
━━━━━
Astronomické pozorování 
Astronom, česky hvězdář, se zabývá zkoumáním vesmíru. Kromě profesionálních astronomů se astronomii věnuje i řada astronomů amatérských.
━━━━━
Nejvýznamnějším zdrojem informací o vesmíru je elektromagnetické záření. Část jeho vlnových délek, vnímatelná očima, je světlo. Obory astronomického pozorování podle využívaných vlnových délek jsou
━━━━━
 gama astronomie
 rentgenová astronomie
 ultrafialová astronomie
 optická astronomie
 infračervená astronomie
 mikrovlnná astronomie
 radioastronomie
━━━━━
Nejstarší a nejdůležitější je optická astronomie, využívající světlo. Rozvoj dalších oborů souvisel s vývojem techniky. Například radioastronomie se začala rozvíjet ve 30. letech 20. století, kdy Karl Guthe Jansky při zkoumání zdrojů šumu rušících rádiové hovory objevil rádiové emise centra naší Galaxie. Atmosféra Země mnoho vlnových délek účinně pohlcuje, takže gama a rentgenové pozorování se mohlo konat jen pomocí stratosférických balónů a výrazný rozvoj se dostavil teprve s pokrokem kosmonautiky.
━━━━━
Ještě exotičtější je pozorování jiných částic než elektromagnetického záření.
 neutrinová astronomie pozoruje neutrina, teleskopy jsou v současnosti velké prostory hluboko pod zemí, zaplněné vodou nebo jiným pozorovacím médiem
 studium kosmického záření, vysokoenergetických částic mimozemského původu. Využívá metod jaderné fyziky (v kosmickém záření se vyskytují i částice s o mnoho řádů větší energií než jaká je dosažitelná na urychlovačích).
━━━━━
Hypotetická gravitační astronomie by měla pozorovat gravitační vlny. V současnosti jsou převažujícím způsobem detekce velké interferometry. První pozorování gravitačních vln proběhlo&nbsp;14. září&nbsp;2015 na americkém detektoru&nbsp;LIGO, i když nepřímé důkazy byly předloženy již dříve.
━━━━━
Astronomická teorie 
Obecným teoretickým oborem je astrofyzika. Zabývá se fyzikou hvězd a mezihvězdné hmoty (hustotou, teplotou, chemickým složením atd.).
━━━━━
Kosmologie studuje vesmír jako celek a zvláště jeho vznik, současný a budoucí vývoj.
━━━━━
Astrobiologie se zabývá možnostmi existence života ve vesmíru.
━━━━━
Astronomie podle objektu zájmu 
 Hvězdná astronomie se zabývá hvězdami, včetně Slunce; výzkumem prostorového rozložení a zákonitostmi pohybů hvězd a hvězdných soustav.
Podle metody výzkumu se dělí na: 1. stelární statistiku, 2. stelární kinematiku, 3. stelární dynamiku
 Galaktická astronomie se zabývá zkoumáním struktury, součástí a vývoje galaxií – v prvé řadě naší Galaxie.
 Extragalaktická astronomie zkoumá objekty za hranicemi naší Galaxie.
 Planetární vědy zkoumají planety v naší sluneční soustavě. Řadí se do astronomie, ale jejich části mají často užší spojitost s odpovídajícími vědami o planetě Zemi (například geologie Marsu).
 Meteorická astronomie se zabývá studiem pohybu a dalšími vlastnostmi meteorů a meteoritů.
━━━━━
Vztah astronomie k dalším vědám 
Astronomie má nejužší vztah s fyzikou. Astronomická teorie je v podstatě fyzika astronomických systémů. Naopak astronomické systémy jsou pro velkou část fyzikální teorie nejdůležitější „laboratoří“, přirozeně především ve velkých prostorových a časových měřítkách se projevuje gravitace a testuje obecná teorie relativity. Ve vesmíru se vyskytují i extrémní podmínky, které nejsou zatím dosažitelné v laboratořích, například tlak, hustota, teplota, magnetické pole a další.
━━━━━
Významný vztah má astronomie i k religionistice.
━━━━━
Odkazy
━━━━━
Reference
━━━━━
Související články 
 Astrofyzika
 Astronomický ústav AV
 Hvězda
 Planeta
 Sluneční soustava
 Souhvězdí
 Vesmír
━━━━━
Externí odkazy 
 
 
 
 
 
━━━━━
 
Přírodní vědy
Sedm svobodných umění
━━━━━</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code slide-code-wide smaller">
<h2>Split Paragraphs to Sentences</h2>
<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell columns column-output-location" data-execution_count="1094">
<div class="column">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> corpy.morphodita <span class="im">import</span> Tokenizer</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>sentence_splitter <span class="op">=</span> Tokenizer(<span class="st">"czech"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_to_sentences(text):</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  RE_PUNCT <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r'[,:;\.?!“"]+'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  sentences <span class="op">=</span> []</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> part <span class="kw">in</span> sentence_splitter.tokenize(text, sents<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    sentence <span class="op">=</span> <span class="st">""</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, token <span class="kw">in</span> <span class="bu">enumerate</span>(part):</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      space <span class="op">=</span> <span class="st">""</span> <span class="cf">if</span> RE_PUNCT.match(token) <span class="kw">or</span> i <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">" "</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      sentence <span class="op">+=</span> space <span class="op">+</span> token</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    sentences.append(sentence)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> sentences</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paragraph <span class="kw">in</span> split_to_paraghraps(ds[<span class="dv">1</span>][<span class="st">"text"</span>]):</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> sentence <span class="kw">in</span> split_to_sentences(paragraph):</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✢"</span>, sentence)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"━━━━━"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>✢ Astronomie, řecky αστρονομία z άστρον ( astron ) hvězda a νόμος ( nomos ) zákon, česky též hvězdářství, je věda, která se zabývá jevy za hranicemi zemské atmosféry.
✢ Zvláště tedy výzkumem vesmírných těles, jejich soustav, různých dějů ve vesmíru i vesmírem jako celkem.
━━━━━
✢ Historie astronomie
━━━━━
✢ Antika Astronomie se podobně jako další vědy začala rozvíjet ve starověku.
✢ Na území Babylonie však nebylo k popisu používáno již vynalezené geometrie ( grafy ).
✢ První se z astronomie rozvíjela astrometrie, zabývající se měřením poloh hvězd a planet na obloze.
✢ Tato oblast astronomie měla velký význam pro navigaci.
✢ Podstatnou částí astrometrie je sférická astronomie sloužící k popisu poloh objektů na nebeské sféře, zavádí souřadnice a popisuje významné křivky a body na nebeské sféře.
✢ Pojmy ze sférické astronomie se také používají při měření času.
━━━━━
✢ Další oblastí astronomie, která se rozvinula, byla nebeská mechanika.
✢ Zabývá se pohybem těles v gravitačním poli, například planet ve sluneční soustavě.
✢ Základem nebeské mechaniky jsou práce Keplera a Newtona.
━━━━━
✢ Aristotelés ve svém díle O nebi z roku 340 př. n. l. dokázal, že tvar Země musí být kulatý, jelikož stín Země na Měsíci je při zatmění vždy kulatý, což by při plochém tvaru Země nebylo možné.
✢ Řekové také zjistili, že pokud sledujeme Polárku z jižnějšího místa na Zemi, jeví se nám níže nad obzorem než pro pozorovatele ze severu, kterému se bude její poloha na obloze jevit výše.
✢ Aristotelés dále určil poloměr Země, který ale odhadl na dvojnásobek skutečného poloměru.
✢ V aristotelovském modelu Země stojí Měsíc se Sluncem a hvězdami krouží kolem ní, a to po kruhových drahách.
✢ Myšlenky Aristotelovy rozvinul ve 2. století našeho letopočtu Klaudios Ptolemaios, který také stavěl Zemi do středu a další objekty nechal obíhat kolem ní ve sférách: první byla sféra Měsíce, dále sféry sluneční soustavy – Slunce a planet: Merkuru, Venuše, Marsu, Jupitera, Saturna a sféra stálic – hvězd, jež byly považovány za nehybné, jak to plyne z názvu, měly se pohybovat jen společně s oblohou.
✢ Tento model dostatečně vyhovoval polohám těles na obloze.
━━━━━
✢ Novověk Roku 1514 navrhl Mikuláš Koperník nový model, ve kterém bylo ve středu soustavy Slunce a planety obíhaly kolem něj po kruhových drahách, setkal se ale s problémy při pozorováních, objekty se nenacházely na správných souřadnicích.
━━━━━
✢ Roku 1609 zkonstruoval Galileo Galilei dalekohled, s jehož pomocí objevil čtyři měsíce obíhající kolem planety Jupiter, a tím dokázal Koperníkovu teorii o Slunci ve středu a planetách kroužících kolem.
━━━━━
✢ Johannes Kepler zaměnil kruhové dráhy planet za eliptické, čímž bylo dosaženo souladu s pozorovanými polohami těles.
━━━━━
✢ V roce 1687 vydal sir Isaac Newton knihu Philosophiae Naturalis Principia Mathematica o poloze těles v prostoru a čase a zákon obecné přitažlivosti, podle něhož jsou k sobě tělesa vázána gravitací, která závisí na hmotnosti těles a na jejich vzdálenosti.
✢ Z gravitačního zákona vychází eliptický pohyb planet.
━━━━━
✢ Nová doba Roku 1929 studoval Edwin Hubble daleké galaxie, zjistil rudý posuv, který se zvětšuje se vzdáleností, to byl důkaz o rozpínání vesmíru.
✢ Fakt, že se od sebe objekty vzdalují, naznačuje, že někdy v minulosti byly objekty velmi blízko od sebe, tím se zrodily myšlenky o velkém třesku, místě a čase, kdy byl vesmír nekonečně malý a hustý.
━━━━━
✢ V letech 1905 – 1915 napsal Albert Einstein teorii relativity – speciální, ve které zavedl konečnou rychlost světla a obecnou relativitu o gravitaci, čase a prostoru ve velkých rozměrech.
✢ Na začátku 20. století vznikla kvantová teorie o chování elementárních částic.
━━━━━
✢ Čínská astronomie
━━━━━
✢ Čínská astronomie má velice dlouhou historii a dějepisci považují Číňany za „ nejdůslednější a nejpřesnější pozorovatele nebeských jevů na světě před Araby.“ Jména hvězd později rozdělili do 28 kategorií ( „ panství“, [ říší ] ) v dobách dynastie Šang ( Shang ) v čínské době bronzové a zřejmě se zformovaly za vlády Wu - Tinga ( Wu Ding ) ( 1339 – 1281 př. n. l. ).
━━━━━
✢ Podrobné záznamy astrologických pozorování započaly v éře válek kolem 4. století př. n. l. a vzkvétaly dále od období dynastie Chan.
✢ Čínská astronomie byla rovníková soustředěná na podrobná pozorování hvězd z okolí pólu a byla založená na jiných principech než převládaly v západoevropské astronomii, kde východ a západ slunce zodiakálních souhvězdí tvořil základní ekliptický rámec.
━━━━━
✢ Některé prvky indické astronomie se dostaly do Číny při expanzi buddhismu po dynastii Chan ( 25 – 220 n. l. ), ale nejpodrobnější vtělení indické astronomie nastalo za dynastie Tchang ( Tang, 618 – 907 ), kdy mnozí indičtí astronomové přesídlili do čínského hlavního města a čínští učenci, jako velký tantrický buddhistický mnich a matematik Ji - Šing ( Yi Xing ) propracoval její systém.
✢ Astronomie islámského středověku úzce spolupracovala se svými čínskými kolegy během dynastie Juan ( Yuan ) a po období poměrného ústupu za dynastie Ming astronomie ožila podněty západní kosmologie a techniky po vzniku jezuitských misií.
✢ Dalekohled byl zaveden v 17. století.
✢ V roce 1669 byla pekingská observatoř přestavěna pod vedením Ferdinanda Verbiesta.
✢ Dnešní Čína pokračuje v astronomických aktivitách s mnoha hvězdárnami a vlastním vesmírným programem.
━━━━━
✢ Části astronomie Od novověku do současnosti se astronomie nesmírně rozšířila a vznikla celá řada nových oblastí výzkumu, které lze velmi zhruba rozdělit na pozorování a teorii, nebo podle objektu zájmu.
━━━━━
✢ Astronomické pozorování Astronom, česky hvězdář, se zabývá zkoumáním vesmíru.
✢ Kromě profesionálních astronomů se astronomii věnuje i řada astronomů amatérských.
━━━━━
✢ Nejvýznamnějším zdrojem informací o vesmíru je elektromagnetické záření.
✢ Část jeho vlnových délek, vnímatelná očima, je světlo.
✢ Obory astronomického pozorování podle využívaných vlnových délek jsou
━━━━━
✢ gama astronomie rentgenová astronomie ultrafialová astronomie optická astronomie infračervená astronomie mikrovlnná astronomie radioastronomie
━━━━━
✢ Nejstarší a nejdůležitější je optická astronomie, využívající světlo.
✢ Rozvoj dalších oborů souvisel s vývojem techniky.
✢ Například radioastronomie se začala rozvíjet ve 30. letech 20. století, kdy Karl Guthe Jansky při zkoumání zdrojů šumu rušících rádiové hovory objevil rádiové emise centra naší Galaxie.
✢ Atmosféra Země mnoho vlnových délek účinně pohlcuje, takže gama a rentgenové pozorování se mohlo konat jen pomocí stratosférických balónů a výrazný rozvoj se dostavil teprve s pokrokem kosmonautiky.
━━━━━
✢ Ještě exotičtější je pozorování jiných částic než elektromagnetického záření. neutrinová astronomie pozoruje neutrina, teleskopy jsou v současnosti velké prostory hluboko pod zemí, zaplněné vodou nebo jiným pozorovacím médiem studium kosmického záření, vysokoenergetických částic mimozemského původu.
✢ Využívá metod jaderné fyziky ( v kosmickém záření se vyskytují i částice s o mnoho řádů větší energií než jaká je dosažitelná na urychlovačích ).
━━━━━
✢ Hypotetická gravitační astronomie by měla pozorovat gravitační vlny.
✢ V současnosti jsou převažujícím způsobem detekce velké interferometry.
✢ První pozorování gravitačních vln proběhlo 14. září 2015 na americkém detektoru LIGO, i když nepřímé důkazy byly předloženy již dříve.
━━━━━
✢ Astronomická teorie Obecným teoretickým oborem je astrofyzika.
✢ Zabývá se fyzikou hvězd a mezihvězdné hmoty ( hustotou, teplotou, chemickým složením atd. ).
━━━━━
✢ Kosmologie studuje vesmír jako celek a zvláště jeho vznik, současný a budoucí vývoj.
━━━━━
✢ Astrobiologie se zabývá možnostmi existence života ve vesmíru.
━━━━━
✢ Astronomie podle objektu zájmu Hvězdná astronomie se zabývá hvězdami, včetně Slunce; výzkumem prostorového rozložení a zákonitostmi pohybů hvězd a hvězdných soustav.
✢ Podle metody výzkumu se dělí na: 1. stelární statistiku, 2. stelární kinematiku, 3. stelární dynamiku Galaktická astronomie se zabývá zkoumáním struktury, součástí a vývoje galaxií – v prvé řadě naší Galaxie.
✢ Extragalaktická astronomie zkoumá objekty za hranicemi naší Galaxie.
✢ Planetární vědy zkoumají planety v naší sluneční soustavě.
✢ Řadí se do astronomie, ale jejich části mají často užší spojitost s odpovídajícími vědami o planetě Zemi ( například geologie Marsu ).
✢ Meteorická astronomie se zabývá studiem pohybu a dalšími vlastnostmi meteorů a meteoritů.
━━━━━
✢ Vztah astronomie k dalším vědám Astronomie má nejužší vztah s fyzikou.
✢ Astronomická teorie je v podstatě fyzika astronomických systémů.
✢ Naopak astronomické systémy jsou pro velkou část fyzikální teorie nejdůležitější „ laboratoří“, přirozeně především ve velkých prostorových a časových měřítkách se projevuje gravitace a testuje obecná teorie relativity.
✢ Ve vesmíru se vyskytují i extrémní podmínky, které nejsou zatím dosažitelné v laboratořích, například tlak, hustota, teplota, magnetické pole a další.
━━━━━
✢ Významný vztah má astronomie i k religionistice.
━━━━━
✢ Odkazy
━━━━━
✢ Reference
━━━━━
✢ Související články Astrofyzika Astronomický ústav AV Hvězda Planeta Sluneční soustava Souhvězdí Vesmír
━━━━━
✢ Externí odkazy
━━━━━
✢ Přírodní vědy Sedm svobodných umění
━━━━━</code></pre>
</div>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Split Page into Chunks with Context Window Limit</h2>
<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell" data-execution_count="1260">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>prefix_token_count <span class="op">=</span> <span class="bu">len</span>(model.tokenizer(PASSAGE_PREFIX)[<span class="st">"input_ids"</span>])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>max_tokens <span class="op">=</span> model.max_seq_length <span class="op">-</span> model.tokenizer.num_special_tokens_to_add() <span class="op">-</span> prefix_token_count</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> <span class="st">"cpu"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.backends.mps.is_available():</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  device <span class="op">=</span> <span class="st">"mps"</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  device <span class="op">=</span> <span class="st">"cuda"</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> model.to(device)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using model [</span><span class="sc">{</span>MODEL_ID<span class="sc">}</span><span class="ss">] on [</span><span class="sc">{</span>model<span class="sc">.</span>device<span class="sc">}</span><span class="ss">] with maximum of [</span><span class="sc">{</span>max_tokens<span class="sc">}</span><span class="ss">] tokens"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using model [intfloat/multilingual-e5-base] on [mps:0] with maximum of [506] tokens</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Split Page into Chunks with Context Window Limit</h2>
<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell" data-execution_count="1261">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> transformers</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>transformers.logging.set_verbosity_error() <span class="co"># Prevent warnings for context window overflow</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_chunks(batch):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> {<span class="st">"chunks"</span>: []}</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> page <span class="kw">in</span> batch[<span class="st">"text"</span>]:</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        page_chunks <span class="op">=</span> []</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        current_chunk <span class="op">=</span> <span class="st">""</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> paragraph <span class="kw">in</span> split_to_paraghraps(page):</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            sentences <span class="op">=</span> split_to_sentences(paragraph)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> sentence <span class="kw">in</span> sentences:</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                candidate_chunk <span class="op">=</span> current_chunk <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> sentence <span class="cf">if</span> current_chunk <span class="cf">else</span> sentence</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                candidate_chunk_tokenized <span class="op">=</span> model.tokenizer(PASSAGE_PREFIX <span class="op">+</span> candidate_chunk, truncation<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">len</span>(candidate_chunk_tokenized[<span class="st">"input_ids"</span>]) <span class="op">&lt;=</span> max_tokens:</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                    current_chunk <span class="op">=</span> candidate_chunk</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                    page_chunks.append(current_chunk)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                    current_chunk <span class="op">=</span> sentence</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> current_chunk: <span class="co"># Add the last chunk if it's not empty</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>            page_chunks.append(current_chunk)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        output[<span class="st">"chunks"</span>].append(page_chunks)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Split Text into Chunks with Context Window Limit</h2>
<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell" data-execution_count="1262">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ds_sample <span class="op">=</span> ds.select(<span class="bu">range</span>(<span class="dv">1000</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ds_chunked <span class="op">=</span> ds_sample.<span class="bu">map</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    generate_chunks,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    batched<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span><span class="dv">1_000</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    num_proc<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    desc<span class="op">=</span><span class="st">"Chunks"</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    load_from_cache_file<span class="op">=</span><span class="va">False</span>) <span class="co"># Disable caching</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"5175bd499dd64647ba48a38acd2ee898","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="1263">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> chunk <span class="kw">in</span> ds_chunked[<span class="dv">1</span>][<span class="st">"chunks"</span>]:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(chunk)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"━━━━━"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Astronomie, řecky αστρονομία z άστρον ( astron ) hvězda a νόμος ( nomos ) zákon, česky též hvězdářství, je věda, která se zabývá jevy za hranicemi zemské atmosféry. Zvláště tedy výzkumem vesmírných těles, jejich soustav, různých dějů ve vesmíru i vesmírem jako celkem. Historie astronomie Antika Astronomie se podobně jako další vědy začala rozvíjet ve starověku. Na území Babylonie však nebylo k popisu používáno již vynalezené geometrie ( grafy ). První se z astronomie rozvíjela astrometrie, zabývající se měřením poloh hvězd a planet na obloze. Tato oblast astronomie měla velký význam pro navigaci. Podstatnou částí astrometrie je sférická astronomie sloužící k popisu poloh objektů na nebeské sféře, zavádí souřadnice a popisuje významné křivky a body na nebeské sféře. Pojmy ze sférické astronomie se také používají při měření času. Další oblastí astronomie, která se rozvinula, byla nebeská mechanika. Zabývá se pohybem těles v gravitačním poli, například planet ve sluneční soustavě. Základem nebeské mechaniky jsou práce Keplera a Newtona. Aristotelés ve svém díle O nebi z roku 340 př. n. l. dokázal, že tvar Země musí být kulatý, jelikož stín Země na Měsíci je při zatmění vždy kulatý, což by při plochém tvaru Země nebylo možné. Řekové také zjistili, že pokud sledujeme Polárku z jižnějšího místa na Zemi, jeví se nám níže nad obzorem než pro pozorovatele ze severu, kterému se bude její poloha na obloze jevit výše. Aristotelés dále určil poloměr Země, který ale odhadl na dvojnásobek skutečného poloměru. V aristotelovském modelu Země stojí Měsíc se Sluncem a hvězdami krouží kolem ní, a to po kruhových drahách.
━━━━━
Myšlenky Aristotelovy rozvinul ve 2. století našeho letopočtu Klaudios Ptolemaios, který také stavěl Zemi do středu a další objekty nechal obíhat kolem ní ve sférách: první byla sféra Měsíce, dále sféry sluneční soustavy – Slunce a planet: Merkuru, Venuše, Marsu, Jupitera, Saturna a sféra stálic – hvězd, jež byly považovány za nehybné, jak to plyne z názvu, měly se pohybovat jen společně s oblohou. Tento model dostatečně vyhovoval polohám těles na obloze. Novověk Roku 1514 navrhl Mikuláš Koperník nový model, ve kterém bylo ve středu soustavy Slunce a planety obíhaly kolem něj po kruhových drahách, setkal se ale s problémy při pozorováních, objekty se nenacházely na správných souřadnicích. Roku 1609 zkonstruoval Galileo Galilei dalekohled, s jehož pomocí objevil čtyři měsíce obíhající kolem planety Jupiter, a tím dokázal Koperníkovu teorii o Slunci ve středu a planetách kroužících kolem. Johannes Kepler zaměnil kruhové dráhy planet za eliptické, čímž bylo dosaženo souladu s pozorovanými polohami těles. V roce 1687 vydal sir Isaac Newton knihu Philosophiae Naturalis Principia Mathematica o poloze těles v prostoru a čase a zákon obecné přitažlivosti, podle něhož jsou k sobě tělesa vázána gravitací, která závisí na hmotnosti těles a na jejich vzdálenosti. Z gravitačního zákona vychází eliptický pohyb planet. Nová doba Roku 1929 studoval Edwin Hubble daleké galaxie, zjistil rudý posuv, který se zvětšuje se vzdáleností, to byl důkaz o rozpínání vesmíru. Fakt, že se od sebe objekty vzdalují, naznačuje, že někdy v minulosti byly objekty velmi blízko od sebe, tím se zrodily myšlenky o velkém třesku, místě a čase, kdy byl vesmír nekonečně malý a hustý.
━━━━━
V letech 1905 – 1915 napsal Albert Einstein teorii relativity – speciální, ve které zavedl konečnou rychlost světla a obecnou relativitu o gravitaci, čase a prostoru ve velkých rozměrech. Na začátku 20. století vznikla kvantová teorie o chování elementárních částic. Čínská astronomie Čínská astronomie má velice dlouhou historii a dějepisci považují Číňany za „ nejdůslednější a nejpřesnější pozorovatele nebeských jevů na světě před Araby.“ Jména hvězd později rozdělili do 28 kategorií ( „ panství“, [ říší ] ) v dobách dynastie Šang ( Shang ) v čínské době bronzové a zřejmě se zformovaly za vlády Wu - Tinga ( Wu Ding ) ( 1339 – 1281 př. n. l. ). Podrobné záznamy astrologických pozorování započaly v éře válek kolem 4. století př. n. l. a vzkvétaly dále od období dynastie Chan. Čínská astronomie byla rovníková soustředěná na podrobná pozorování hvězd z okolí pólu a byla založená na jiných principech než převládaly v západoevropské astronomii, kde východ a západ slunce zodiakálních souhvězdí tvořil základní ekliptický rámec. Některé prvky indické astronomie se dostaly do Číny při expanzi buddhismu po dynastii Chan ( 25 – 220 n. l. ), ale nejpodrobnější vtělení indické astronomie nastalo za dynastie Tchang ( Tang, 618 – 907 ), kdy mnozí indičtí astronomové přesídlili do čínského hlavního města a čínští učenci, jako velký tantrický buddhistický mnich a matematik Ji - Šing ( Yi Xing ) propracoval její systém. Astronomie islámského středověku úzce spolupracovala se svými čínskými kolegy během dynastie Juan ( Yuan ) a po období poměrného ústupu za dynastie Ming astronomie ožila podněty západní kosmologie a techniky po vzniku jezuitských misií. Dalekohled byl zaveden v 17. století.
━━━━━
V roce 1669 byla pekingská observatoř přestavěna pod vedením Ferdinanda Verbiesta. Dnešní Čína pokračuje v astronomických aktivitách s mnoha hvězdárnami a vlastním vesmírným programem. Části astronomie Od novověku do současnosti se astronomie nesmírně rozšířila a vznikla celá řada nových oblastí výzkumu, které lze velmi zhruba rozdělit na pozorování a teorii, nebo podle objektu zájmu. Astronomické pozorování Astronom, česky hvězdář, se zabývá zkoumáním vesmíru. Kromě profesionálních astronomů se astronomii věnuje i řada astronomů amatérských. Nejvýznamnějším zdrojem informací o vesmíru je elektromagnetické záření. Část jeho vlnových délek, vnímatelná očima, je světlo. Obory astronomického pozorování podle využívaných vlnových délek jsou gama astronomie rentgenová astronomie ultrafialová astronomie optická astronomie infračervená astronomie mikrovlnná astronomie radioastronomie Nejstarší a nejdůležitější je optická astronomie, využívající světlo. Rozvoj dalších oborů souvisel s vývojem techniky. Například radioastronomie se začala rozvíjet ve 30. letech 20. století, kdy Karl Guthe Jansky při zkoumání zdrojů šumu rušících rádiové hovory objevil rádiové emise centra naší Galaxie. Atmosféra Země mnoho vlnových délek účinně pohlcuje, takže gama a rentgenové pozorování se mohlo konat jen pomocí stratosférických balónů a výrazný rozvoj se dostavil teprve s pokrokem kosmonautiky. Ještě exotičtější je pozorování jiných částic než elektromagnetického záření. neutrinová astronomie pozoruje neutrina, teleskopy jsou v současnosti velké prostory hluboko pod zemí, zaplněné vodou nebo jiným pozorovacím médiem studium kosmického záření, vysokoenergetických částic mimozemského původu. Využívá metod jaderné fyziky ( v kosmickém záření se vyskytují i částice s o mnoho řádů větší energií než jaká je dosažitelná na urychlovačích ).
━━━━━
Hypotetická gravitační astronomie by měla pozorovat gravitační vlny. V současnosti jsou převažujícím způsobem detekce velké interferometry. První pozorování gravitačních vln proběhlo 14. září 2015 na americkém detektoru LIGO, i když nepřímé důkazy byly předloženy již dříve. Astronomická teorie Obecným teoretickým oborem je astrofyzika. Zabývá se fyzikou hvězd a mezihvězdné hmoty ( hustotou, teplotou, chemickým složením atd. ). Kosmologie studuje vesmír jako celek a zvláště jeho vznik, současný a budoucí vývoj. Astrobiologie se zabývá možnostmi existence života ve vesmíru. Astronomie podle objektu zájmu Hvězdná astronomie se zabývá hvězdami, včetně Slunce; výzkumem prostorového rozložení a zákonitostmi pohybů hvězd a hvězdných soustav. Podle metody výzkumu se dělí na: 1. stelární statistiku, 2. stelární kinematiku, 3. stelární dynamiku Galaktická astronomie se zabývá zkoumáním struktury, součástí a vývoje galaxií – v prvé řadě naší Galaxie. Extragalaktická astronomie zkoumá objekty za hranicemi naší Galaxie. Planetární vědy zkoumají planety v naší sluneční soustavě. Řadí se do astronomie, ale jejich části mají často užší spojitost s odpovídajícími vědami o planetě Zemi ( například geologie Marsu ). Meteorická astronomie se zabývá studiem pohybu a dalšími vlastnostmi meteorů a meteoritů. Vztah astronomie k dalším vědám Astronomie má nejužší vztah s fyzikou. Astronomická teorie je v podstatě fyzika astronomických systémů. Naopak astronomické systémy jsou pro velkou část fyzikální teorie nejdůležitější „ laboratoří“, přirozeně především ve velkých prostorových a časových měřítkách se projevuje gravitace a testuje obecná teorie relativity. Ve vesmíru se vyskytují i extrémní podmínky, které nejsou zatím dosažitelné v laboratořích, například tlak, hustota, teplota, magnetické pole a další. Významný vztah má astronomie i k religionistice. Odkazy
━━━━━
Reference Související články Astrofyzika Astronomický ústav AV Hvězda Planeta Sluneční soustava Souhvězdí Vesmír Externí odkazy Přírodní vědy Sedm svobodných umění
━━━━━</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Inspect the Data</h2>
<div class="footer">
<p>➊ Pre-process the Data</p>
</div>
<div class="cell columns column-output-location" data-execution_count="1393">
<div class="column">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>num_tokens <span class="op">=</span> np.array([</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">len</span>(model.tokenizer(PASSAGE_PREFIX <span class="op">+</span> chunk, truncation<span class="op">=</span><span class="va">False</span>)[<span class="st">'input_ids'</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> page_chunks <span class="kw">in</span> ds_chunked[<span class="st">"chunks"</span>]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> chunk <span class="kw">in</span> page_chunks</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>num_chunks <span class="op">=</span> [</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">len</span>(page_chunks) <span class="cf">for</span> page_chunks <span class="kw">in</span> ds_chunked[<span class="st">"chunks"</span>]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"      Number of chunks:"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"mean=</span><span class="sc">{</span>np<span class="sc">.</span>mean(num_chunks)<span class="sc">:.2f}</span><span class="ss">"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"± </span><span class="sc">{</span>np<span class="sc">.</span>std(num_chunks)<span class="sc">:.2f}</span><span class="ss">,"</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"min=</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">min</span>(num_chunks)<span class="sc">}</span><span class="ss">,"</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"max=</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(num_chunks)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"      Chunks over limit:"</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>(num_tokens <span class="op">&gt;</span> model.max_seq_length)<span class="sc">.</span><span class="bu">sum</span>() <span class="op">/</span> <span class="bu">sum</span>(num_chunks) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%,"</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"max=</span><span class="sc">{</span>num_tokens<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>plt.hist(num_chunks, bins<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Chunks'</span>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>      Number of chunks: mean=6.20 ± 9.00, min=1, max=83
      Chunks over limit: 8.76%, max=725</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img data-src="wikipedia-semantic-search_files/figure-revealjs/cell-19-output-2.png"></p>
</div>
</div>
</div>
</section>
<section class="slide level2">
<h2>➋ Generate the Embeddings</h2>
<ul>
<li>Generate embeddings for each chunk</li>
<li>Computationally expensive, best suited for GPU</li>
<li>Performance: Hardware, batch size</li>
</ul>
</section>
<section class="slide level2 slide-code smaller">
<h2>Helpers: Decorator for Measuring Duration</h2>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functools</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> record_duration(func):</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Measures the duration of function execution and stores it in internal attribute"""</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  func._durations <span class="op">=</span> []</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">@functools.wraps</span>(func)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(batch, <span class="op">**</span>kwargs):</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.perf_counter()</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> func(batch, <span class="op">**</span>kwargs)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    duration <span class="op">=</span> time.perf_counter() <span class="op">-</span> start</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    func._durations.append(duration)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Helpers: Decorator for Recording Metrics</h2>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> humanize</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> record_metrics(func):</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Measures and displays statistics about function execution"""</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">@functools.wraps</span>(func)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> wrapper(ds, fn, map_batch_size, encode_batch_size, num_total):</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    num_items <span class="op">=</span> <span class="bu">len</span>(ds)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.perf_counter()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> func(ds, fn, map_batch_size, encode_batch_size, num_total)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">finally</span>:</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>      total_duration <span class="op">=</span> time.perf_counter() <span class="op">-</span> start</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>      throughput <span class="op">=</span> num_items <span class="op">/</span> total_duration</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> fn._durations:</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>        batch_duration_min <span class="op">=</span> np.<span class="bu">min</span>(fn._durations)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>        batch_duration_max <span class="op">=</span> np.<span class="bu">max</span>(fn._durations)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        batch_duration_mean <span class="op">=</span> np.mean(fn._durations)</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Batch durations:"</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"min=</span><span class="sc">{</span>batch_duration_min<span class="sc">:.2f}</span><span class="ss">s,"</span>, <span class="ss">f"max=</span><span class="sc">{</span>batch_duration_max<span class="sc">:.2f}</span><span class="ss">s,"</span>, <span class="ss">f"mean=</span><span class="sc">{</span>batch_duration_mean<span class="sc">:.2f}</span><span class="ss">s"</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Duration: </span><span class="sc">{</span>humanize<span class="sc">.</span>precisedelta(total_duration, minimum_unit<span class="op">=</span><span class="st">'seconds'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">,"</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"throughput: </span><span class="sc">{</span>throughput<span class="sc">:.2f}</span><span class="ss"> pages/sec,"</span>,</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>              <span class="ss">f"estimated running time: </span><span class="sc">{</span>humanize<span class="sc">.</span>precisedelta(num_total<span class="op">/</span>map_batch_size<span class="op">*</span>batch_duration_mean, minimum_unit<span class="op">=</span><span class="st">'minutes'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> wrapper</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Helpers: Wrapper for Calling The Embedding Function</h2>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="1395">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="at">@record_metrics</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_embeddings(ds, fn, map_batch_size<span class="op">=</span><span class="dv">100</span>, encode_batch_size<span class="op">=</span><span class="dv">1000</span>, num_total<span class="op">=</span><span class="bu">len</span>(ds)):</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Execute function fn on dataset ds and display statistics"""</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  num_items <span class="op">=</span> <span class="bu">len</span>(ds)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> time.perf_counter()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  info <span class="op">=</span> (</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    fn.__doc__ <span class="op">+</span> <span class="ss">f" | Device: </span><span class="sc">{</span>device<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">"</span> <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Pages: </span><span class="sc">{</span>num_items<span class="sc">:,</span>d<span class="sc">}</span><span class="ss"> | Batch size: </span><span class="sc">{</span>map_batch_size<span class="sc">:,</span>d<span class="sc">}</span><span class="ss"> | Encode batch_size: </span><span class="sc">{</span>encode_batch_size<span class="sc">:,</span>d<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ds.<span class="bu">map</span>(</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>      fn,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>      fn_kwargs<span class="op">=</span>{<span class="st">"encode_batch_size"</span>:encode_batch_size},</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>      batched<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>      batch_size<span class="op">=</span>map_batch_size,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>      desc<span class="op">=</span><span class="st">"Embeddings"</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>      load_from_cache_file<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span> <span class="im">as</span> e:</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[!] Interrupted after </span><span class="sc">{</span>time<span class="sc">.</span>perf_counter() <span class="op">-</span> start<span class="sc">:.2f}</span><span class="ss">sec."</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> torch.cuda.OutOfMemoryError <span class="im">as</span> e:</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"[!] </span><span class="sc">{</span>e<span class="sc">.</span>__class__<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span><span class="st">'. '</span><span class="sc">.</span>join(<span class="bu">str</span>(e).split(<span class="st">'. '</span>)[<span class="dv">0</span>:<span class="dv">3</span>]) <span class="op">+</span> <span class="st">'.'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">finally</span>:</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2><small>a)</small> Generate Embeddings Sequentialy</h2>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="at">@record_duration</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_embeddings_sequential(batch, <span class="op">**</span>kwargs):</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Strategy: sequential, one call per chunk"""</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  output <span class="op">=</span> {<span class="st">"embeddings"</span>: []}</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> page_chunks <span class="kw">in</span> batch[<span class="st">"chunks"</span>]:</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    page_embeddings <span class="op">=</span> []</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> chunk <span class="kw">in</span> page_chunks:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>      chunk_embeddings <span class="op">=</span> model.encode(chunk, batch_size<span class="op">=</span>kwargs.get(<span class="st">"encode_batch_size"</span>, <span class="dv">1000</span>))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>      page_embeddings.append(chunk_embeddings)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    output[<span class="st">"embeddings"</span>].append(page_embeddings)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ds_emb <span class="op">=</span> generate_embeddings(ds_chunked, create_embeddings_sequential, map_batch_size<span class="op">=</span><span class="dv">100</span>, encode_batch_size<span class="op">=</span><span class="dv">1000</span>, num_total<span class="op">=</span><span class="bu">len</span>(ds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b55df64db3e048ca8f0ee9ed872b95f5","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Strategy: sequential, one call per chunk | Device: MPS
Pages: 1,000 | Batch size: 100 | Encode batch_size: 1,000
Batch durations: min=22.31s, max=50.36s, mean=38.52s
Duration: 6 minutes and 32 seconds, throughput: 2.55 pages/sec, estimated running time: 2 days, 9 hours and 8 minutes</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2><small>b)</small> Generate Embeddings in Parallel for All Page Chunks</h2>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="at">@record_duration</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_embeddings_parallel_page(batch, <span class="op">**</span>kwargs):</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">"""Strategy: parallel, one call per page"""</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  output <span class="op">=</span> {<span class="st">"embeddings"</span>: []}</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> page_chunks <span class="kw">in</span> batch[<span class="st">"chunks"</span>]:</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    page_embeddings <span class="op">=</span> model.encode(page_chunks, batch_size<span class="op">=</span>kwargs.get(<span class="st">"encode_batch_size"</span>, <span class="dv">1000</span>))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    output[<span class="st">"embeddings"</span>].append(page_embeddings)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ds_emb <span class="op">=</span> generate_embeddings(ds_chunked, create_embeddings_parallel_page, map_batch_size<span class="op">=</span><span class="dv">100</span>, encode_batch_size<span class="op">=</span><span class="dv">1000</span>, num_total<span class="op">=</span><span class="bu">len</span>(ds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"a5102b233f074024ac050e7080529e8f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Strategy: parallel, one call per page | Device: MPS
Pages: 1,000 | Batch size: 100 | Encode batch_size: 1,000
Batch durations: min=14.07s, max=24.34s, mean=18.62s
Duration: 3 minutes and 14 seconds, throughput: 5.15 pages/sec, estimated running time: 1 day, 3 hours and 37 minutes</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2><small>c)</small> Generate Embeddings in Parallel for the Whole Batch</h2>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="at">@record_duration</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_embeddings_parallel_batch(batch, <span class="op">**</span>kwargs):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Strategy: one call per batch, with restructuring"""</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> {<span class="st">"embeddings"</span>: []}</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flatten all chunks in batch into a single list</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    flat_chunks <span class="op">=</span> [chunk <span class="cf">for</span> page_chunks <span class="kw">in</span> batch[<span class="st">"chunks"</span>] <span class="cf">for</span> chunk <span class="kw">in</span> page_chunks]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    flat_embeddings <span class="op">=</span> model.encode(flat_chunks, batch_size<span class="op">=</span>kwargs.get(<span class="st">"encode_batch_size"</span>, <span class="dv">1000</span>))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-assemble the structure of the embeddings to match the input batch of pages</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">0</span>  <span class="co"># Current position in the flat_embeddings list</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> page_chunks <span class="kw">in</span> batch[<span class="st">"chunks"</span>]:</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        num_chunks <span class="op">=</span> <span class="bu">len</span>(page_chunks)  <span class="co"># Number of chunks for current page</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Slice the embeddings from the flat_embeddings list</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        page_embeddings <span class="op">=</span> flat_embeddings[i : i <span class="op">+</span> num_chunks]</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        output[<span class="st">"embeddings"</span>].append(page_embeddings)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> num_chunks  <span class="co"># Update the index position</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ds_emb <span class="op">=</span> generate_embeddings(ds_chunked, create_embeddings_parallel_batch, map_batch_size<span class="op">=</span><span class="dv">100</span>, encode_batch_size<span class="op">=</span><span class="dv">1000</span>, num_total<span class="op">=</span><span class="bu">len</span>(ds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"d5136bebf583441898737a950caaf81f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Strategy: one call per batch, with restructuring | Device: MPS
Pages: 1,000 | Batch size: 100 | Encode batch_size: 1,000
Batch durations: min=2.76s, max=6.18s, mean=4.47s
Duration: 52 seconds, throughput: 19.00 pages/sec, estimated running time: 6 hours and 38 minutes</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Throughput: Pages Per Second</h2>
<p>Apple M3 Max, NVIDIA GeForce RTX 4090, NVIDIA A100 80GB</p>

<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell columns column-output-location" data-execution_count="1394">
<div class="column">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.read_csv(<span class="st">"data/metrics.csv"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>alt.Chart(metrics_df, width<span class="op">=</span><span class="dv">200</span>, padding<span class="op">=</span><span class="dv">10</span>).mark_bar(</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  cornerRadiusEnd<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  binSpacing<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>).encode(</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  x<span class="op">=</span>alt.X(<span class="st">'throughput:Q'</span>, title<span class="op">=</span><span class="va">None</span>, axis<span class="op">=</span>{<span class="st">'orient'</span>:<span class="st">'top'</span>}),</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  y<span class="op">=</span>alt.Y(<span class="st">'implementation:N'</span>, title<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  yOffset<span class="op">=</span>alt.YOffset(<span class="st">'num_pages:N'</span>),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  row<span class="op">=</span>alt.Row(<span class="st">'device_name:N'</span>, title<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>              sort<span class="op">=</span>[<span class="st">'a100'</span>, <span class="st">'rtx-4090'</span>, <span class="st">'m3-max'</span>]),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  color<span class="op">=</span>alt.Color(<span class="st">'num_pages:N'</span>,</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>                  scale<span class="op">=</span>alt.Scale(scheme<span class="op">=</span><span class="st">'set1'</span>),</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>                  title<span class="op">=</span><span class="va">None</span>),</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  tooltip<span class="op">=</span>[</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'device_name'</span>,</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'implementation'</span>,</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'num_pages'</span>,</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'throughput'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-display" data-execution_count="1394">

<style>
  #altair-viz-456ded335c57439fac51df1959459342.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-456ded335c57439fac51df1959459342.vega-embed details,
  #altair-viz-456ded335c57439fac51df1959459342.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-456ded335c57439fac51df1959459342"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-456ded335c57439fac51df1959459342") {
      outputDiv = document.getElementById("altair-viz-456ded335c57439fac51df1959459342");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.16.3?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.16.3"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-b30f767c433853421dd46dbb9f98ef84"}, "mark": {"type": "bar", "binSpacing": 2, "cornerRadiusEnd": 2}, "encoding": {"color": {"field": "num_pages", "scale": {"scheme": "set1"}, "title": null, "type": "nominal"}, "row": {"field": "device_name", "sort": ["a100", "rtx-4090", "m3-max"], "title": null, "type": "nominal"}, "tooltip": [{"field": "device_name", "type": "nominal"}, {"field": "implementation", "type": "nominal"}, {"field": "num_pages", "type": "quantitative"}, {"field": "throughput", "type": "quantitative"}], "x": {"axis": {"orient": "top"}, "field": "throughput", "title": null, "type": "quantitative"}, "y": {"field": "implementation", "title": null, "type": "nominal"}, "yOffset": {"field": "num_pages", "type": "nominal"}}, "padding": 10, "width": 200, "$schema": "https://vega.github.io/schema/vega-lite/v5.16.3.json", "datasets": {"data-b30f767c433853421dd46dbb9f98ef84": [{"Unnamed: 0": 3, "implementation": "create_embeddings_sequential", "device_type": "MPS", "device_name": "m3-max", "device_info": "m3-max-mps", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 247.77223254198907, "throughput": 4.035964763850338, "min_duration": 17.401388917001896, "max_duration": 34.378650124999695, "mean_duration": 24.03367872920062}, {"Unnamed: 0": 4, "implementation": "create_embeddings_parallel_page", "device_type": "MPS", "device_name": "m3-max", "device_info": "m3-max-mps", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 228.46622016699985, "throughput": 4.377014681947464, "min_duration": 11.901914332993329, "max_duration": 29.113616457994794, "mean_duration": 22.11304713330173}, {"Unnamed: 0": 5, "implementation": "create_embeddings_parallel_batch", "device_type": "MPS", "device_name": "m3-max", "device_info": "m3-max-mps", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 67.95902479099459, "throughput": 14.714749116478089, "min_duration": 2.757536541990703, "max_duration": 11.325305000005756, "mean_duration": 6.008715983500588}, {"Unnamed: 0": 9, "implementation": "create_embeddings_sequential", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 188.3925132260192, "throughput": 5.308066562073382, "min_duration": 9.864557188004255, "max_duration": 29.46253813011572, "mean_duration": 18.43356993533671}, {"Unnamed: 0": 10, "implementation": "create_embeddings_parallel_page", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 45.380948398960754, "throughput": 22.035678743613488, "min_duration": 3.4234943059273064, "max_duration": 5.089134408161044, "mean_duration": 4.099871359486133}, {"Unnamed: 0": 11, "implementation": "create_embeddings_parallel_batch", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 1000, "map_batch_size": 10.0, "encode_batch_size": 1000.0, "total_duration": 24.03447675914504, "throughput": 41.606897042994845, "min_duration": 0.0363102511037141, "max_duration": 1.2418507039546969, "mean_duration": 0.1935074247210286}, {"Unnamed: 0": 12, "implementation": "create_embeddings_sequential", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 5000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 994.7829352600966, "throughput": 5.026222126229675, "min_duration": 7.355776490876451, "max_duration": 41.05631630704738, "mean_duration": 19.803826822559348}, {"Unnamed: 0": 13, "implementation": "create_embeddings_parallel_page", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 5000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 207.6293034960981, "throughput": 24.08137924565143, "min_duration": 3.3026222879998386, "max_duration": 5.859481386840344, "mean_duration": 4.036378885945306}, {"Unnamed: 0": 14, "implementation": "create_embeddings_parallel_batch", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 5000, "map_batch_size": 10.0, "encode_batch_size": 1000.0, "total_duration": 104.53412756603213, "throughput": 47.83126923637068, "min_duration": 0.0388324949890375, "max_duration": 1.2960564950481055, "mean_duration": 0.1942237078305334}, {"Unnamed: 0": 15, "implementation": "create_embeddings_parallel_page", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 50000, "map_batch_size": 1000.0, "encode_batch_size": 1000.0, "total_duration": 1774.4695705620106, "throughput": 28.177434445474308, "min_duration": 30.72697459394112, "max_duration": 57.73582288692705, "mean_duration": 35.09485867723357}, {"Unnamed: 0": 16, "implementation": "create_embeddings_parallel_batch", "device_type": "CUDA", "device_name": "rtx-4090", "device_info": "rtx-4090-cuda", "num_pages": 50000, "map_batch_size": 10.0, "encode_batch_size": 500.0, "total_duration": 722.2194288070314, "throughput": 69.23103700296522, "min_duration": 0.0330811021849513, "max_duration": 3.896171391941607, "mean_duration": 0.1368736956728622}, {"Unnamed: 0": 20, "implementation": "create_embeddings_sequential", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 50.511659348383546, "throughput": 19.79740940805188, "min_duration": 2.6452941726893187, "max_duration": 7.723219372332096, "mean_duration": 4.932920461520553}, {"Unnamed: 0": 21, "implementation": "create_embeddings_parallel_page", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 29.373896284028888, "throughput": 34.043832330943374, "min_duration": 1.6890865433961153, "max_duration": 4.258179413154721, "mean_duration": 2.814694369211793}, {"Unnamed: 0": 22, "implementation": "create_embeddings_parallel_batch", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 1000, "map_batch_size": 100.0, "encode_batch_size": 1000.0, "total_duration": 24.18323518522084, "throughput": 41.35096037982265, "min_duration": 1.2339102029800415, "max_duration": 3.630253599956632, "mean_duration": 2.2953676452860234}, {"Unnamed: 0": 23, "implementation": "create_embeddings_sequential", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 5000, "map_batch_size": 1000.0, "encode_batch_size": 1000.0, "total_duration": 263.60818984918296, "throughput": 18.967544228654766, "min_duration": 40.12282294780016, "max_duration": 62.75354970805347, "mean_duration": 52.24163052327931}, {"Unnamed: 0": 24, "implementation": "create_embeddings_parallel_page", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 5000, "map_batch_size": 1000.0, "encode_batch_size": 1000.0, "total_duration": 142.3300096169114, "throughput": 35.12962595490409, "min_duration": 22.800316836684942, "max_duration": 32.688373072072864, "mean_duration": 28.0423240352422}, {"Unnamed: 0": 25, "implementation": "create_embeddings_parallel_batch", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 5000, "map_batch_size": 1000.0, "encode_batch_size": 1000.0, "total_duration": 102.54322223551571, "throughput": 48.75992670209125, "min_duration": 16.01880633458495, "max_duration": 23.73845813423395, "mean_duration": 20.091905187815428}, {"Unnamed: 0": 26, "implementation": "create_embeddings_parallel_page", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 50000, "map_batch_size": 1000.0, "encode_batch_size": 1000.0, "total_duration": 1065.03233342804, "throughput": 46.94693149743542, "min_duration": 13.634426517412066, "max_duration": 54.98637079447508, "mean_duration": 21.155522922500968}, {"Unnamed: 0": 27, "implementation": "create_embeddings_parallel_batch", "device_type": "CUDA", "device_name": "a100", "device_info": "a100-cuda", "num_pages": 50000, "map_batch_size": 1000.0, "encode_batch_size": 1000.0, "total_duration": 577.4295165520161, "throughput": 86.59065490549077, "min_duration": 4.995810279622674, "max_duration": 39.11978733353317, "mean_duration": 11.405137999877333}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</div>
<aside><div>
<p>Total running time on NVIDIA A100 80GB ≈ 2 hours</p>
<p>Total cost for OpenAI embeddings model ≈ $12</p>
</div></aside></section>
<section class="slide level2">
<h2>Load the Ready-Made Dataset</h2>
<p><a href="https://huggingface.co/datasets/karmiq/karmiq/wikipedia-embeddings-cs-e5-base"><img data-src="https://huggingface.co/front/assets/huggingface_logo-noborder.svg" class="icon" width="40" height="40"> <code>karmiq/wikipedia-embeddings-cs-e5-base</code></a></p>
<div class="footer">
<p>➋ Generate the Embeddings</p>
</div>
<div class="cell" data-execution_count="532">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>DATASET_ID <span class="op">=</span> <span class="st">"karmiq/wikipedia-embeddings-cs-e5-base"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>ds_emb <span class="op">=</span> datasets.load_dataset(DATASET_ID, split<span class="op">=</span><span class="st">"train"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>ds_emb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="532">
<pre><code>Dataset({
    features: ['id', 'url', 'title', 'chunks', 'embeddings'],
    num_rows: 534044
})</code></pre>
</div>
</div>
</section>
<section class="slide level2">
<h2>➌ Index the Data</h2>
<ul>
<li>Using the Bulk API</li>
<li>Performance: Dataset iteration</li>
<li>Performance: JSON serialization</li>
<li>Performance: Number of segments</li>
</ul>
</section>
<section class="slide level2 slide-code smaller">
<h2>Setup Indexing</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="534">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> urllib.parse <span class="im">import</span> urlparse</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.notebook <span class="im">import</span> tqdm</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elasticsearch <span class="im">import</span> Elasticsearch</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>ELASTICSEARCH_URL <span class="op">=</span> os.getenv(<span class="st">"ELASTICSEARCH_URL"</span>, <span class="st">"http://localhost:9200"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>INDEX_NAME <span class="op">=</span> <span class="st">"wikipedia-search-v999"</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>INDEX_ALIAS <span class="op">=</span> <span class="ss">f"wikipedia-search-sample"</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> Elasticsearch(hosts<span class="op">=</span>ELASTICSEARCH_URL, request_timeout<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using model [</span><span class="sc">{</span>MODEL_ID<span class="sc">}</span><span class="ss">] on [</span><span class="sc">{</span>model<span class="sc">.</span>device<span class="sc">}</span><span class="ss">] "</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"with [</span><span class="sc">{</span>model<span class="sc">.</span>get_sentence_embedding_dimension()<span class="sc">}</span><span class="ss">] dimensions "</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Using dataset [</span><span class="sc">{</span>DATASET_ID<span class="sc">}</span><span class="ss">] (</span><span class="sc">{</span>humanize<span class="sc">.</span>naturalsize(ds_emb.size_in_bytes)<span class="sc">}</span><span class="ss">) with </span><span class="sc">{</span>ds_emb<span class="sc">.</span>num_rows<span class="sc">:,}</span><span class="ss"> rows"</span>)</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Connected to Elasticsearch at [</span><span class="sc">{</span>urlparse(ELASTICSEARCH_URL)<span class="sc">.</span>hostname<span class="sc">}</span><span class="ss">] "</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"with index [</span><span class="sc">{</span>INDEX_NAME<span class="sc">}</span><span class="ss">] and alias [</span><span class="sc">{</span>INDEX_ALIAS<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using model [intfloat/multilingual-e5-base] on [mps:0] with [768] dimensions 
Using dataset [karmiq/wikipedia-embeddings-cs-e5-base] (9.9 GB) with 534,044 rows
Connected to Elasticsearch at [localhost] with index [wikipedia-search-v999] and alias [wikipedia-search-sample]</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Index Mappings</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="535">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mapping <span class="op">=</span> {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"properties"</span>: {</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"title"</span>: { <span class="st">"type"</span>: <span class="st">"keyword"</span> },</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"url"</span>:   { <span class="st">"type"</span>: <span class="st">"keyword"</span>, <span class="st">"index"</span>: <span class="va">False</span> },</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"parts"</span>: {</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span>: <span class="st">"nested"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"properties"</span>: {</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"chunk"</span>: {</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"type"</span>: <span class="st">"text"</span>,</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"analyzer"</span>: <span class="st">"czech"</span>,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"embedding"</span>: {</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"type"</span>: <span class="st">"dense_vector"</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"dims"</span>: model.get_sentence_embedding_dimension(),</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"index"</span>: <span class="va">True</span>,</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"similarity"</span>: <span class="st">"cosine"</span>,</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"meta"</span>: { <span class="st">"model"</span>: MODEL_ID },</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"_source"</span>: {</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"excludes"</span>: [<span class="st">"parts.embedding"</span>]</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Create the Index</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="536">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>skip_indexing <span class="op">=</span> es.indices.exists(index<span class="op">=</span>INDEX_NAME)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> skip_indexing:</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"Skipping index creation for [</span><span class="sc">{</span>INDEX_NAME<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> es.indices.exists_alias(name<span class="op">=</span>INDEX_ALIAS):</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    es.indices.delete_alias(name<span class="op">=</span>INDEX_ALIAS, index<span class="op">=</span><span class="st">"*"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  es.indices.create(</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>      index<span class="op">=</span>INDEX_NAME,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>      mappings<span class="op">=</span>mapping,</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>      aliases<span class="op">=</span>{INDEX_ALIAS:{}},</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"Created index [</span><span class="sc">{</span>INDEX_NAME<span class="sc">}</span><span class="ss">] with alias [</span><span class="sc">{</span>INDEX_ALIAS<span class="sc">}</span><span class="ss">]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Created index [wikipedia-search-v999] with alias [wikipedia-search-sample]</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Performance: Dataset Iteration</h2>
<p><a href="https://huggingface.co/docs/datasets/about_arrow#performance" class="uri">https://huggingface.co/docs/datasets/about_arrow#performance</a></p>
<p><a href="https://discuss.huggingface.co/t/slow-iteration-speed-with-and-without-keep-in-memory-true/33587/2" class="uri">https://discuss.huggingface.co/t/slow-iteration-speed-with-and-without-keep-in-memory-true/33587/2</a></p>
<aside class="notes">
<blockquote>
<p>To read tokenized text from Arrow, the bottleneck is often the conversion of the tokenized Arrow data to pythons lists.</p>
</blockquote>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit <span class="op">-</span>r <span class="dv">3</span> <span class="op">-</span>n <span class="dv">3</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> ds_emb.select(<span class="bu">range</span>(<span class="dv">100_000</span>)):</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> row[<span class="st">"id"</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    _ <span class="op">=</span> row[<span class="st">"embeddings"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21.9 s ± 57.2 ms per loop (mean ± std. dev. of 3 runs, 3 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>timeit <span class="op">-</span>r <span class="dv">3</span> <span class="op">-</span>n <span class="dv">3</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> batch <span class="kw">in</span> ds_emb.select(<span class="bu">range</span>(<span class="dv">100_000</span>)).with_format(<span class="st">"numpy"</span>).<span class="bu">iter</span>(<span class="dv">1000</span>):</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(batch[<span class="st">"id"</span>]):</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>      _ <span class="op">=</span> item</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>      _ <span class="op">=</span> batch[<span class="st">"embeddings"</span>][i].tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>2.98 s ± 13.1 ms per loop (mean ± std. dev. of 3 runs, 3 loops each)</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Performance: NumPy JSON Serialization</h2>
<p><a href="https://github.com/ijl/orjson#numpy" class="uri">https://github.com/ijl/orjson#numpy</a></p>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy, json, orjson</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> numpy.arange(<span class="dv">500</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>r <span class="dv">100</span> <span class="op">-</span>n <span class="dv">10_000</span> json.dumps(a.tolist())</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>r <span class="dv">100</span> <span class="op">-</span>n <span class="dv">10_000</span> orjson.dumps(a, option<span class="op">=</span>orjson.OPT_SERIALIZE_NUMPY)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21.3 µs ± 303 ns per loop (mean ± std. dev. of 100 runs, 10,000 loops each)
2.22 µs ± 175 ns per loop (mean ± std. dev. of 100 runs, 10,000 loops each)</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Custom JSON Serializer for the Elasticsearch Client</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install <span class="op">-</span>q orjson</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="537">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> orjson</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elasticsearch <span class="im">import</span> JSONSerializer</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> OrjsonSerializer(JSONSerializer):</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> json_loads(<span class="va">self</span>, data):</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> orjson.loads(data)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> json_dumps(<span class="va">self</span>, data):</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> orjson.dumps(data, option<span class="op">=</span>orjson.OPT_SERIALIZE_NUMPY)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> Elasticsearch(</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    hosts<span class="op">=</span>ELASTICSEARCH_URL, request_timeout<span class="op">=</span><span class="dv">300</span>, serializer<span class="op">=</span>OrjsonSerializer()</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Batch Generator</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="1396">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> doc_generator(data, batch_size<span class="op">=</span><span class="dv">1000</span>):</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> batch <span class="kw">in</span> data.with_format(<span class="st">"numpy"</span>).<span class="bu">iter</span>(batch_size):</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, <span class="bu">id</span> <span class="kw">in</span> <span class="bu">enumerate</span>(batch[<span class="st">"id"</span>]):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>      output <span class="op">=</span> {<span class="st">"id"</span>: <span class="bu">id</span>}</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>      output[<span class="st">"title"</span>] <span class="op">=</span> batch[<span class="st">"title"</span>][i]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>      output[<span class="st">"url"</span>] <span class="op">=</span> batch[<span class="st">"url"</span>][i]</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      output[<span class="st">"parts"</span>] <span class="op">=</span> [</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>          { <span class="st">"chunk"</span>: chunk, <span class="st">"embedding"</span>: embedding }</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> chunk, embedding <span class="kw">in</span> <span class="bu">zip</span>(batch[<span class="st">"chunks"</span>][i], batch[<span class="st">"embeddings"</span>][i])</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">yield</span> output</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.printoptions(linewidth<span class="op">=</span><span class="dv">120</span>, threshold<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  display(<span class="bu">list</span>(doc_generator(ds_emb.select(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">2</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[{'id': '10',
  'title': 'Astronomie',
  'url': 'https://cs.wikipedia.org/wiki/Astronomie',
  'parts': [{'chunk': 'Astronomie, řecky αστρονομία z άστρον ( astron ) hvězda a νόμος ( nomos ) zákon, česky též hvězdářství, je věda, která se zabývá jevy za hranicemi zemské atmosféry. Zvláště tedy výzkumem vesmírných těles, jejich soustav, různých dějů ve vesmíru i vesmírem jako celkem. Historie astronomie Antika Astronomie se podobně jako další vědy začala rozvíjet ve starověku. Na území Babylonie však nebylo k popisu používáno již vynalezené geometrie ( grafy ). První se z astronomie rozvíjela astrometrie, zabývající se měřením poloh hvězd a planet na obloze. Tato oblast astronomie měla velký význam pro navigaci. Podstatnou částí astrometrie je sférická astronomie sloužící k popisu poloh objektů na nebeské sféře, zavádí souřadnice a popisuje významné křivky a body na nebeské sféře. Pojmy ze sférické astronomie se také používají při měření času. Další oblastí astronomie, která se rozvinula, byla nebeská mechanika. Zabývá se pohybem těles v gravitačním poli, například planet ve sluneční soustavě. Základem nebeské mechaniky jsou práce Keplera a Newtona. Aristotelés ve svém díle O nebi z roku 340 př. n. l. dokázal, že tvar Země musí být kulatý, jelikož stín Země na Měsíci je při zatmění vždy kulatý, což by při plochém tvaru Země nebylo možné. Řekové také zjistili, že pokud sledujeme Polárku z jižnějšího místa na Zemi, jeví se nám níže nad obzorem než pro pozorovatele ze severu, kterému se bude její poloha na obloze jevit výše. Aristotelés dále určil poloměr Země, který ale odhadl na dvojnásobek skutečného poloměru. V aristotelovském modelu Země stojí Měsíc se Sluncem a hvězdami krouží kolem ní, a to po kruhových drahách.',
    'embedding': array([-0.00116814,  0.01576309,  0.0007256 , ..., -0.04695565, -0.05386008,  0.01633682], dtype=float32)},
   {'chunk': 'Myšlenky Aristotelovy rozvinul ve 2. století našeho letopočtu Klaudios Ptolemaios, který také stavěl Zemi do středu a další objekty nechal obíhat kolem ní ve sférách: první byla sféra Měsíce, dále sféry sluneční soustavy – Slunce a planet: Merkuru, Venuše, Marsu, Jupitera, Saturna a sféra stálic – hvězd, jež byly považovány za nehybné, jak to plyne z názvu, měly se pohybovat jen společně s oblohou. Tento model dostatečně vyhovoval polohám těles na obloze. Novověk Roku 1514 navrhl Mikuláš Koperník nový model, ve kterém bylo ve středu soustavy Slunce a planety obíhaly kolem něj po kruhových drahách, setkal se ale s problémy při pozorováních, objekty se nenacházely na správných souřadnicích. Roku 1609 zkonstruoval Galileo Galilei dalekohled, s jehož pomocí objevil čtyři měsíce obíhající kolem planety Jupiter, a tím dokázal Koperníkovu teorii o Slunci ve středu a planetách kroužících kolem. Johannes Kepler zaměnil kruhové dráhy planet za eliptické, čímž bylo dosaženo souladu s pozorovanými polohami těles. V roce 1687 vydal sir Isaac Newton knihu Philosophiae Naturalis Principia Mathematica o poloze těles v prostoru a čase a zákon obecné přitažlivosti, podle něhož jsou k sobě tělesa vázána gravitací, která závisí na hmotnosti těles a na jejich vzdálenosti. Z gravitačního zákona vychází eliptický pohyb planet. Nová doba Roku 1929 studoval Edwin Hubble daleké galaxie, zjistil rudý posuv, který se zvětšuje se vzdáleností, to byl důkaz o rozpínání vesmíru. Fakt, že se od sebe objekty vzdalují, naznačuje, že někdy v minulosti byly objekty velmi blízko od sebe, tím se zrodily myšlenky o velkém třesku, místě a čase, kdy byl vesmír nekonečně malý a hustý.',
    'embedding': array([ 0.01262999,  0.0201088 ,  0.01402295, ..., -0.06196119, -0.05728577,  0.02889508], dtype=float32)},
   {'chunk': 'V letech 1905 – 1915 napsal Albert Einstein teorii relativity – speciální, ve které zavedl konečnou rychlost světla a obecnou relativitu o gravitaci, čase a prostoru ve velkých rozměrech. Na začátku 20. století vznikla kvantová teorie o chování elementárních částic. Čínská astronomie Čínská astronomie má velice dlouhou historii a dějepisci považují Číňany za „ nejdůslednější a nejpřesnější pozorovatele nebeských jevů na světě před Araby.“ Jména hvězd později rozdělili do 28 kategorií ( „ panství“, [ říší ] ) v dobách dynastie Šang ( Shang ) v čínské době bronzové a zřejmě se zformovaly za vlády Wu - Tinga ( Wu Ding ) ( 1339 – 1281 př. n. l. ). Podrobné záznamy astrologických pozorování započaly v éře válek kolem 4. století př. n. l. a vzkvétaly dále od období dynastie Chan. Čínská astronomie byla rovníková soustředěná na podrobná pozorování hvězd z okolí pólu a byla založená na jiných principech než převládaly v západoevropské astronomii, kde východ a západ slunce zodiakálních souhvězdí tvořil základní ekliptický rámec. Některé prvky indické astronomie se dostaly do Číny při expanzi buddhismu po dynastii Chan ( 25 – 220 n. l. ), ale nejpodrobnější vtělení indické astronomie nastalo za dynastie Tchang ( Tang, 618 – 907 ), kdy mnozí indičtí astronomové přesídlili do čínského hlavního města a čínští učenci, jako velký tantrický buddhistický mnich a matematik Ji - Šing ( Yi Xing ) propracoval její systém. Astronomie islámského středověku úzce spolupracovala se svými čínskými kolegy během dynastie Juan ( Yuan ) a po období poměrného ústupu za dynastie Ming astronomie ožila podněty západní kosmologie a techniky po vzniku jezuitských misií. Dalekohled byl zaveden v 17. století.',
    'embedding': array([-0.00705293,  0.05072778,  0.00480559, ..., -0.02520603, -0.05879226,  0.00373061], dtype=float32)},
   {'chunk': 'V roce 1669 byla pekingská observatoř přestavěna pod vedením Ferdinanda Verbiesta. Dnešní Čína pokračuje v astronomických aktivitách s mnoha hvězdárnami a vlastním vesmírným programem. Části astronomie Od novověku do současnosti se astronomie nesmírně rozšířila a vznikla celá řada nových oblastí výzkumu, které lze velmi zhruba rozdělit na pozorování a teorii, nebo podle objektu zájmu. Astronomické pozorování Astronom, česky hvězdář, se zabývá zkoumáním vesmíru. Kromě profesionálních astronomů se astronomii věnuje i řada astronomů amatérských. Nejvýznamnějším zdrojem informací o vesmíru je elektromagnetické záření. Část jeho vlnových délek, vnímatelná očima, je světlo. Obory astronomického pozorování podle využívaných vlnových délek jsou gama astronomie rentgenová astronomie ultrafialová astronomie optická astronomie infračervená astronomie mikrovlnná astronomie radioastronomie Nejstarší a nejdůležitější je optická astronomie, využívající světlo. Rozvoj dalších oborů souvisel s vývojem techniky. Například radioastronomie se začala rozvíjet ve 30. letech 20. století, kdy Karl Guthe Jansky při zkoumání zdrojů šumu rušících rádiové hovory objevil rádiové emise centra naší Galaxie. Atmosféra Země mnoho vlnových délek účinně pohlcuje, takže gama a rentgenové pozorování se mohlo konat jen pomocí stratosférických balónů a výrazný rozvoj se dostavil teprve s pokrokem kosmonautiky. Ještě exotičtější je pozorování jiných částic než elektromagnetického záření. neutrinová astronomie pozoruje neutrina, teleskopy jsou v současnosti velké prostory hluboko pod zemí, zaplněné vodou nebo jiným pozorovacím médiem studium kosmického záření, vysokoenergetických částic mimozemského původu. Využívá metod jaderné fyziky ( v kosmickém záření se vyskytují i částice s o mnoho řádů větší energií než jaká je dosažitelná na urychlovačích ).',
    'embedding': array([-0.02492211,  0.04009932, -0.00356649, ..., -0.02678077, -0.05529132,  0.04100281], dtype=float32)},
   {'chunk': 'Hypotetická gravitační astronomie by měla pozorovat gravitační vlny. V současnosti jsou převažujícím způsobem detekce velké interferometry. První pozorování gravitačních vln proběhlo 14. září 2015 na americkém detektoru LIGO, i když nepřímé důkazy byly předloženy již dříve. Astronomická teorie Obecným teoretickým oborem je astrofyzika. Zabývá se fyzikou hvězd a mezihvězdné hmoty ( hustotou, teplotou, chemickým složením atd. ). Kosmologie studuje vesmír jako celek a zvláště jeho vznik, současný a budoucí vývoj. Astrobiologie se zabývá možnostmi existence života ve vesmíru. Astronomie podle objektu zájmu Hvězdná astronomie se zabývá hvězdami, včetně Slunce; výzkumem prostorového rozložení a zákonitostmi pohybů hvězd a hvězdných soustav. Podle metody výzkumu se dělí na: 1. stelární statistiku, 2. stelární kinematiku, 3. stelární dynamiku Galaktická astronomie se zabývá zkoumáním struktury, součástí a vývoje galaxií – v prvé řadě naší Galaxie. Extragalaktická astronomie zkoumá objekty za hranicemi naší Galaxie. Planetární vědy zkoumají planety v naší sluneční soustavě. Řadí se do astronomie, ale jejich části mají často užší spojitost s odpovídajícími vědami o planetě Zemi ( například geologie Marsu ). Meteorická astronomie se zabývá studiem pohybu a dalšími vlastnostmi meteorů a meteoritů. Vztah astronomie k dalším vědám Astronomie má nejužší vztah s fyzikou. Astronomická teorie je v podstatě fyzika astronomických systémů. Naopak astronomické systémy jsou pro velkou část fyzikální teorie nejdůležitější „ laboratoří“, přirozeně především ve velkých prostorových a časových měřítkách se projevuje gravitace a testuje obecná teorie relativity. Ve vesmíru se vyskytují i extrémní podmínky, které nejsou zatím dosažitelné v laboratořích, například tlak, hustota, teplota, magnetické pole a další. Významný vztah má astronomie i k religionistice.',
    'embedding': array([-0.03006952,  0.01395531,  0.00581896, ..., -0.04385962, -0.05145555,  0.02000373], dtype=float32)},
   {'chunk': 'Odkazy Reference Související články Astrofyzika Astronomický ústav AV Hvězda Planeta Sluneční soustava Souhvězdí Vesmír Externí odkazy Přírodní vědy Sedm svobodných umění',
    'embedding': array([-0.01606593,  0.05223566, -0.00174637, ..., -0.05588794, -0.03942919,  0.0295324 ], dtype=float32)}]}]</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Batch Indexing</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="539">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elasticsearch.helpers <span class="im">import</span> parallel_bulk</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ds_to_index <span class="op">=</span> ds_emb.select(<span class="bu">range</span>(<span class="dv">100_000</span>))</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> skip_indexing:</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"Skipping indexing for [</span><span class="sc">{</span>INDEX_NAME<span class="sc">}</span><span class="ss">]"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  num_threads, batch_size <span class="op">=</span> <span class="dv">8</span>, <span class="dv">1_000</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  num_indexed, num_failed <span class="op">=</span> <span class="dv">0</span>, <span class="dv">0</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  progress <span class="op">=</span> tqdm(total<span class="op">=</span>ds_to_index.num_rows, unit<span class="op">=</span><span class="st">"doc"</span>, desc<span class="op">=</span><span class="st">"Indexing"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  start <span class="op">=</span> time.perf_counter()</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span>:</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    es.indices.put_settings(index<span class="op">=</span>INDEX_NAME, settings<span class="op">=</span>{<span class="st">"index.refresh_interval"</span>: <span class="st">"-1"</span>})</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ok, info <span class="kw">in</span> parallel_bulk(</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>        es,</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>INDEX_NAME,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>        actions<span class="op">=</span>doc_generator(ds_to_index),</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>        thread_count<span class="op">=</span>num_threads,</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        chunk_size<span class="op">=</span>batch_size,</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        raise_on_error<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ok:</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>            num_indexed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>            num_failed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"ERROR </span><span class="sc">{</span>info[<span class="st">'index'</span>][<span class="st">'status'</span>]<span class="sc">}</span><span class="ss">: "</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"</span><span class="sc">{</span>info[<span class="st">'index'</span>][<span class="st">'error'</span>][<span class="st">'type'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>info[<span class="st">'index'</span>][<span class="st">'error'</span>][<span class="st">'caused_by'</span>][<span class="st">'type'</span>]<span class="sc">}</span><span class="ss">: "</span></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"</span><span class="sc">{</span>info[<span class="st">'index'</span>][<span class="st">'error'</span>][<span class="st">'caused_by'</span>][<span class="st">'reason'</span>][:<span class="dv">250</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        progress.update(<span class="dv">1</span>)</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">except</span> <span class="pp">KeyboardInterrupt</span>:</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Indexing interrupted by the user after [</span><span class="sc">{</span>num_indexed<span class="sc">:,</span>d<span class="sc">}</span><span class="ss">] documents"</span>)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">finally</span>:</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>    es.indices.refresh(index<span class="op">=</span>INDEX_NAME)</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>    es.indices.put_settings(index<span class="op">=</span>INDEX_NAME, settings<span class="op">=</span>{<span class="st">"index.refresh_interval"</span>: <span class="va">None</span>})</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    progress.close()</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>  duration <span class="op">=</span> time.perf_counter() <span class="op">-</span> start</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>  index_stats <span class="op">=</span> es.indices.stats(index<span class="op">=</span>INDEX_NAME, metric<span class="op">=</span><span class="st">'store'</span>, human<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"Indexed [</span><span class="sc">{</span>num_indexed<span class="sc">:,</span>d<span class="sc">}</span><span class="ss">] documents with [</span><span class="sc">{</span>num_failed<span class="sc">:,</span>d<span class="sc">}</span><span class="ss">] errors"</span>,</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"in </span><span class="sc">{</span>humanize<span class="sc">.</span>precisedelta(duration, minimum_unit<span class="op">=</span><span class="st">'seconds'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'</span><span class="sc">%d</span><span class="st">'</span>)<span class="sc">}</span><span class="ss">,"</span>,</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"throughput: </span><span class="sc">{</span>(num_indexed<span class="op">//</span>duration)<span class="sc">:,}</span><span class="ss"> doc/sec,"</span>,</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"disk size: </span><span class="sc">{</span>index_stats[<span class="st">'_all'</span>][<span class="st">'primaries'</span>][<span class="st">'store'</span>][<span class="st">'size'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c0ee248104cc48c4bd31f85c18de2742","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Indexed [100,000] documents with [0] errors in 33 seconds, throughput: 2,945.0 doc/sec, disk size: 3.9gb</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Performance: Optimize the Index</h2>

<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell columns column-output-location" data-execution_count="540">
<div class="column">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(es.cat.segments(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  index<span class="op">=</span>INDEX_NAME, v<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  h<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"shard"</span>, <span class="st">"docs.count"</span>, <span class="st">"size"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>index                 shard docs.count    size
wikipedia-search-v999 0          23640 220.1mb
wikipedia-search-v999 0          21735 207.6mb
wikipedia-search-v999 0          13197 128.9mb
wikipedia-search-v999 0          15927 155.2mb
wikipedia-search-v999 0          10883 106.4mb
wikipedia-search-v999 0          14310 140.4mb
wikipedia-search-v999 0           9435  92.7mb
wikipedia-search-v999 0           6045  60.9mb
wikipedia-search-v999 0           2265  21.8mb
wikipedia-search-v999 0           1590  15.3mb
wikipedia-search-v999 0           2854  25.9mb
wikipedia-search-v999 0           2112  20.3mb
wikipedia-search-v999 0           3038  26.3mb
wikipedia-search-v999 0           2468  22.7mb
wikipedia-search-v999 0           1710  16.3mb
wikipedia-search-v999 0           1349  13.5mb
wikipedia-search-v999 0          14934 124.8mb
wikipedia-search-v999 0          12713   108mb
wikipedia-search-v999 0          13954 119.4mb
wikipedia-search-v999 0           9180  79.5mb
wikipedia-search-v999 0          12862 111.2mb
wikipedia-search-v999 0           9337  81.7mb
wikipedia-search-v999 0           9102  80.9mb
wikipedia-search-v999 0          10759    94mb
wikipedia-search-v999 0           2396  19.8mb
wikipedia-search-v999 0           2582  21.3mb
wikipedia-search-v999 0           2407  19.9mb
wikipedia-search-v999 0           1908  16.6mb
wikipedia-search-v999 0           1070   9.3mb
wikipedia-search-v999 0          12958 105.9mb
wikipedia-search-v999 0          13216 108.5mb
wikipedia-search-v999 0          13288 109.4mb
wikipedia-search-v999 0          14317 116.2mb
wikipedia-search-v999 0          13661   112mb
wikipedia-search-v999 0          10891  91.2mb
wikipedia-search-v999 0          14723 120.6mb
wikipedia-search-v999 0          12256 101.3mb
wikipedia-search-v999 0           2349  18.5mb
wikipedia-search-v999 0           1206   9.6mb
wikipedia-search-v999 0           2051  16.6mb
wikipedia-search-v999 0           1170   9.7mb
wikipedia-search-v999 0            239   1.9mb
wikipedia-search-v999 0           2069  16.7mb
wikipedia-search-v999 0           1070   8.9mb
wikipedia-search-v999 0          11056  87.3mb
wikipedia-search-v999 0           6883    55mb
wikipedia-search-v999 0           8887  72.6mb
wikipedia-search-v999 0           7157  58.9mb
wikipedia-search-v999 0           6832    56mb
wikipedia-search-v999 0           6823  56.2mb
wikipedia-search-v999 0           7922  64.8mb
wikipedia-search-v999 0           6419  53.6mb
</code></pre>
</div>
</div>
</div>
<aside><div>
<blockquote>
<p>If you force merge to one segment, the kNN search only need to check a single, all-inclusive HNSW graph.</p>
<p><strong>We recommend only force merging a read-only index (meaning the index is no longer receiving writes)</strong></p>
<p>— <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-knn-search.html#_force_merge_to_one_segment" class="uri">https://www.elastic.co/guide/en/elasticsearch/reference/current/tune-knn-search.html#_force_merge_to_one_segment</a></p>
</blockquote>
</div></aside></section>
<section class="slide level2 slide-code smaller">
<h2>Performance: Optimize the Index</h2>
<div class="footer">
<p>➌ Index the Data</p>
</div>
<div class="cell" data-execution_count="541">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>task_id <span class="op">=</span> es.indices.forcemerge(index<span class="op">=</span>INDEX_NAME, max_num_segments<span class="op">=</span><span class="dv">1</span>, wait_for_completion<span class="op">=</span><span class="va">False</span>)[<span class="st">'task'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="543">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>task <span class="op">=</span> es.tasks.get(task_id<span class="op">=</span>task_id)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="ss">f"[</span><span class="sc">{</span>task_id<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span><span class="st">'Completed in'</span> <span class="cf">if</span> task[<span class="st">'completed'</span>] <span class="cf">else</span> <span class="st">'Running for'</span><span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="ss">f"</span><span class="sc">{</span>task[<span class="st">'task'</span>][<span class="st">'running_time_in_nanos'</span>]<span class="op">/</span><span class="fl">6e+10</span><span class="sc">:.2f}</span><span class="ss"> minutes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[6_7-709IT3GjbUs9kfWYsA:222682] Completed in 3.29 minutes</code></pre>
</div>
</div>
<div class="cell" data-execution_count="544">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(es.cat.segments(index<span class="op">=</span>INDEX_NAME, v<span class="op">=</span><span class="va">True</span>, h<span class="op">=</span>[<span class="st">"index"</span>, <span class="st">"shard"</span>, <span class="st">"docs.count"</span>, <span class="st">"size"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>index                 shard docs.count  size
wikipedia-search-v999 0         413205 1.6gb
</code></pre>
</div>
</div>
</section>
<section class="slide level2">
<h2>➍ Search the Data</h2>
<ul>
<li>Compare lexical and semantic search</li>
<li>Performance: Inference on CPU</li>
</ul>
<div class="cell" data-execution_count="564">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>INDEX_ALIAS <span class="op">=</span> <span class="st">"wikipedia-search-base"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="1121">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>MODEL_ID, model.device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1121">
<pre><code>('intfloat/multilingual-e5-base', device(type='mps', index=0))</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Lexical Search</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="585">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_lexical(client, query, size<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> client.search(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>INDEX_ALIAS,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    query<span class="op">=</span>{</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"nested"</span>: {</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"path"</span>: <span class="st">"parts"</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"query"</span>: {</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"match"</span>: {</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"parts.chunk"</span>: query,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>          },</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"inner_hits"</span>: {</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">"_source"</span>: {<span class="st">"includes"</span>: <span class="st">"parts.chunk"</span>},</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">"size"</span>: <span class="dv">5</span>,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    size<span class="op">=</span>size,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>    sort<span class="op">=</span>[<span class="st">"_score"</span>, <span class="st">"_doc"</span>],</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    _source_excludes<span class="op">=</span>[<span class="st">"parts"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Semantic Search</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1095">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search_semantic(client, model, query, size<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"e5"</span> <span class="kw">in</span> MODEL_ID: query <span class="op">=</span> <span class="ss">f"query: </span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> client.search(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>INDEX_ALIAS,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>        query<span class="op">=</span>{</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"nested"</span>: {</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"path"</span>: <span class="st">"parts"</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"query"</span>: {</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"knn"</span>: {</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"field"</span>: <span class="st">"parts.embedding"</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"query_vector"</span>: model.encode(query),</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"num_candidates"</span>: <span class="dv">1000</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>              },</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">"inner_hits"</span>: {</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"_source"</span>: {<span class="st">"includes"</span>: <span class="st">"parts.chunk"</span>},</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"size"</span>: <span class="dv">5</span>, <span class="co"># Currently returns only 1 // https://github.com/elastic/elasticsearch/pull/104006</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>              },</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>        size<span class="op">=</span>size,</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>        sort<span class="op">=</span>[<span class="st">"_score"</span>, <span class="st">"_doc"</span>],</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        _source_excludes<span class="op">=</span>[<span class="st">"parts"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Search And Display Results</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1099">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> textwrap</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> search(type_, query, model<span class="op">=</span><span class="va">None</span>, size<span class="op">=</span><span class="dv">15</span>):</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> type_ <span class="op">==</span> <span class="st">"lexical"</span>:</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> display_results(query, type_, search_lexical(es, query, size<span class="op">=</span>size))</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">elif</span> type_ <span class="op">==</span> <span class="st">"semantic"</span>:</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> display_results(query, type_, search_semantic(es, model, query, size<span class="op">=</span>size))</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>     <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Unexpected search type: </span><span class="sc">{</span>type_<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_results(query, typ, results):</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">len</span>(results[<span class="st">'hits'</span>][<span class="st">'hits'</span>])<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>typ<span class="sc">}</span><span class="ss"> results for «</span><span class="sc">{</span>query<span class="sc">}</span><span class="ss">» ﹙</span><span class="sc">{</span>results[<span class="st">'took'</span>]<span class="sc">:,}</span><span class="ss">ms﹚</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i, hit <span class="kw">in</span> <span class="bu">enumerate</span>(results[<span class="st">"hits"</span>][<span class="st">"hits"</span>], start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">:2d}</span><span class="ss">. </span><span class="sc">{</span>hit[<span class="st">'_source'</span>][<span class="st">'title'</span>]<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f" [score=</span><span class="sc">{</span>hit[<span class="st">'_score'</span>]<span class="sc">:0.4f}</span><span class="ss">]"</span>,</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="st">"─"</span> <span class="op">*</span> <span class="dv">100</span>, sep<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> inner_hit <span class="kw">in</span> hit[<span class="st">"inner_hits"</span>][<span class="st">"parts"</span>][<span class="st">"hits"</span>][<span class="st">"hits"</span>]:</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"</span><span class="sc">{</span>textwrap<span class="sc">.</span>shorten(inner_hit[<span class="st">'_source'</span>][<span class="st">'chunk'</span>], width<span class="op">=</span><span class="dv">250</span>, placeholder<span class="op">=</span><span class="st">' …'</span>)<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>            end<span class="op">=</span><span class="st">" "</span>)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>      <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Lexical Search</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1100">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>search(<span class="st">"lexical"</span>, <span class="st">"Co je to staroměstský orloj?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
15 lexical results for «Co je to staroměstský orloj?» ﹙10ms﹚

 1. Kadaňský orloj [score=25.1477]
────────────────────────────────────────────────────────────────────────────────────────────────────
Kadaňský orloj je umělecké dílo v Kadani na Nábřeží Maxipsa Fíka v prostoru pod Kadaňským hradem. Jedná se o kovovou repliku původního hodinového stroje pražského staroměstského orloje nazvanou „ Pocta Mikulášovi z Kadaně“. Autorem mohutné kované … 

 2. Jakub Čech (hodinář) [score=23.6815]
────────────────────────────────────────────────────────────────────────────────────────────────────
Jakub Čech, též Jacob Zech, Czech a Zähen ( † 1540 Praha ) byl český hodinář a orlojník Staroměstského orloje. Život Řemeslu se naučil u Jana z Růže ( mistra Hanuše, snad vlastního otce ) a po něm od roku 1497 vykonával funkci orlojníka … 

 3. Pohádkový orloj v Ostravě [score=23.1809]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pohádkový orloj v Ostravě je součást nové přístavby Divadla loutek Ostrava. Na rozdíl od tradičních orlojů neobsahuje astronomický ciferník, ale jen symbol hvězdné oblohy a troje dveře, které ukrývají šest dřevěných pohádkových postav: krále, … 

 4. Chmelový orloj [score=22.8751]
────────────────────────────────────────────────────────────────────────────────────────────────────
Chmelový orloj je součástí Chrámu chmele a piva v Žatci. Orloj, jeden ze šesti funkčních orlojů v Česku, je tvořen ocelovou konstrukcí o rozměrech 4 × 7 metrů potaženou měděným plechem. Ideu architekta Chrámu chmele a piva Jiřího Vaníčka … 

 5. Jan Táborský z Klokotské Hory [score=22.5301]
────────────────────────────────────────────────────────────────────────────────────────────────────
Do některých kancionálů ze své dílny psal také verše s akrostichy. V kancionálu svatovítském z roku 1551 a ve" Zprávě o orloji" je i jeho portrét. Orloj Roku 1551 byl Táborský městskou radou pověřen dělat po Janu Zvůnkovi správce Staroměstského … Výzdoba hudebních rukopisů Jana Táborského z Klokotské Hory. Praha: Academia, 2019. Související články Kancionál Staroměstský orloj Externí odkazy Čeští humanisté Čeští astronomové Čeští hudební skladatelé Hodináři Čeští spisovatelé Narození v roce … 

 6. Orloj [score=21.9641]
────────────────────────────────────────────────────────────────────────────────────────────────────
Orloj ( z lat. horologium, hodiny, a ital. orologio ) jsou obvykle věžní hodiny, které kromě času ukazují další údaje, například polohu Slunce a Měsíce na obloze, případně fázi Měsíce, polohy dalších planet, sluneční čas a další. V určitém smyslu … Významné historické orloje Itálie – Benátky, Brescia, Clusone, Cremona, Modena, Messina, Padova, Německo – Heilbronn, Rostock, Lübeck, Münster, Mnichov, Norimberk, Rostock, Stralsund Francie – Beauvais, Besançon, Bourges, Lyon, Ploërmel, Rouen, … Byl zkonstruován v roce 1410 a dále upravován a rozšiřován, mj. jeho domnělým tvůrcem, orlojníkem mistrem Hanušem. Skutečného autora orloje, Mikuláše z Kadaně, připomíná v jeho rodišti nefunkční replika astronomické části orloje. Jediným … 

 7. Ludvík Hainz [score=21.1384]
────────────────────────────────────────────────────────────────────────────────────────────────────
Ludvík Hainz ( 5. dubna 1847 Praha – 20. května 1893 Praha ) byl pražský hodinář, podnikatel a orlojník. Život a působení Narodil se v rodině Ludvíka Hainze ( 1815 – 1875 ), jednoho z nejlepších pražských hodinářů, a v jeho dílně na Staroměstském … 

 8. Seznam osobností Prahy [score=20.9304]
────────────────────────────────────────────────────────────────────────────────────────────────────
Společně s Konradem Sweynheymem přinesli do Itálie techniku rukotisku Mistr Hanuš ( Jan ) zvaný Růže ( † po roce 1497 ), pražský staroměstský zámečník, hodinář a orlojník, údajný tvůrce Staroměstského orloje Alžběta Lucemburská ( 1409 – 1442 ), … 

 9. Mistr Hanuš [score=20.7482]
────────────────────────────────────────────────────────────────────────────────────────────────────
Mistr Hanuš, tedy Jan, zvaný Růže ( † po roce 1497 ) byl pražský staroměstský zámečník, hodinář a orlojník Staroměstského orloje. Vstoupil do obecného povědomí hlavně díky Jiráskovým Starým pověstem českým, podle kterých měl být samotným tvůrcem … Rozsah vylepšení není jistý, nicméně o Hanušově zručnosti ještě lépe svědčí to, že sestrojil v 90. letech orloj pro radnici v Jindřichově Hradci, za což dostal slušně zaplaceno. Měl ženu Kateřinu a s ní syna Jakuba a dceru Annu. Předpokládá se, že … Externí odkazy KDO BYL KDO v našich dějinách do roku 1918 Mistr Hanuš orloj nepostavil Mistr Hanuš pražský orloj nesestrojil! I staré české pověsti se pletou... Osoby s nejistým datem narození Osoby s nejistým datem úmrtí Muži Narození v 15. … 

10. Cisiojan [score=20.1796]
────────────────────────────────────────────────────────────────────────────────────────────────────
Cisiojan ( výslovnost [ - zi - ] ) byla mnemotechnická pomůcka k zapamatování nepohyblivých svátků v křesťanském kalendáři používaná ve středověku. V Čechách byl používaný od 13. století až do 17. století. Cisiojány měly formu obvykle sylabických … 

11. Nábřeží Maxipsa Fíka [score=20.1796]
────────────────────────────────────────────────────────────────────────────────────────────────────
Nedaleko Splitu se nachází následující atrakce Dřevěná pramice, která je uložená dnem vzhůru Hadovor – masivní dřevěný prvek je umístěný v laguně pod ulicí Václava Havla, vedle AmFíku Kdo dál dostříkne – dvě kola umístěná u řeky Ohře, jejichž … 

12. Pražský poledník [score=20.1027]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pražský poledník ( 14 ° 25 ' 17“ východní délky ) prochází Staroměstským náměstím v Praze. Historicky byl definován stínem Mariánského sloupu v pravé poledne. Měření času Staroměstský orloj na daném náměstí sloužil k určování času již od 15. … 

13. Orloj v Krásném Lese [score=20.0918]
────────────────────────────────────────────────────────────────────────────────────────────────────
Orloj v Krásném Lese je společenská událost, která se koná pravidelně na Boží Hod vánoční ( 25. prosince ) vždy v poledne v Krásném Lese ve Frýdlantském výběžku na severu České republiky. Její první ročník se uskutečnil roku 2008. Boční stěna … 

14. Hodinová věž [score=19.9345]
────────────────────────────────────────────────────────────────────────────────────────────────────
Hodinová věž je věž, na které jsou umístěné hodiny. Velikostí a ostatními technickými parametry musí hodiny vyhovovat dané věži. Čas se často ukazuje na více cifernících viditelných z různých stran. Věž může být samostatná stavba nebo může být … 

15. Staroměstská radnice [score=19.3790]
────────────────────────────────────────────────────────────────────────────────────────────────────
S většími či menšími časovými odstupy pak následovaly další soutěže ( 1938, 1947, 1963, 1966 – 1967 a 1988 ), které si zejména od válečného požáru kladou za cíl zaplnit prostor po zbouraném novogotickém křídle radnice. Všechny však buďto skončily … Popis od východu k západu ( zprava doleva ): Wolflinův dům – původní jádro radnice pořízené roku 1338 na rohu náměstí Věž radnice vybudovaná před rokem 1364 Pozůstatek novogotického křídla ( na severu ) – v roce 1838 – 1848 nahradilo starší budovu, … Staroměstská radnice v Praze byla založena roku 1338 ( jako první v Čechách ) na základě privilegia uděleného staroměstským měšťanům králem Janem Lucemburským. Tvoří ji komplex několika domů přiléhajících ke Staroměstskému náměstí postupně … Domy východního křídla však byly záhy zbourány a na jejich místě v letech 1838 – 1848 vystavěli vídeňští architekti Pietro Nobile a Pavel Sprenger neogotické křídlo. Roku 1880 byl architektem Baumem novorenesančně přestavěn Mikšův dům. Požár … 
</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Semantic Search</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1101">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>search(<span class="st">"semantic"</span>, <span class="st">"Co je to staroměstský orloj?"</span>, model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
15 semantic results for «Co je to staroměstský orloj?» ﹙36ms﹚

 1. Orloj [score=0.9310]
────────────────────────────────────────────────────────────────────────────────────────────────────
Orloj ( z lat. horologium, hodiny, a ital. orologio ) jsou obvykle věžní hodiny, které kromě času ukazují další údaje, například polohu Slunce a Měsíce na obloze, případně fázi Měsíce, polohy dalších planet, sluneční čas a další. V určitém smyslu … Významné historické orloje Itálie – Benátky, Brescia, Clusone, Cremona, Modena, Messina, Padova, Německo – Heilbronn, Rostock, Lübeck, Münster, Mnichov, Norimberk, Rostock, Stralsund Francie – Beauvais, Besançon, Bourges, Lyon, Ploërmel, Rouen, … Byl zkonstruován v roce 1410 a dále upravován a rozšiřován, mj. jeho domnělým tvůrcem, orlojníkem mistrem Hanušem. Skutečného autora orloje, Mikuláše z Kadaně, připomíná v jeho rodišti nefunkční replika astronomické části orloje. Jediným … 

 2. Staroměstský orloj [score=0.9272]
────────────────────────────────────────────────────────────────────────────────────────────────────
Kolem roku 1470 byla doplněna architektonická a sochařská výzdoba a roku 1490 orloj upravil hodinář mistr Hanuš. V druhé polovině 16. století upravil a zdokonalil Staroměstský orloj Jan Táborský z Klokotské Hory. Další dvě zásadní opravy byly … U příležitosti 600 let od první zmínky o orloji vyšla 16. června 2010 česká známka v nominální hodnotě 21 Kč. Orloj je zastoupen v koláži významných pražských památek na rubu české pětitisícové bankovky. ČNB vydala 17. března 2010 pamětní stříbrnou … Staroměstský orloj nebo také Pražský orloj jsou středověké astronomické hodiny umístěné na jižní straně věže Staroměstské radnice v Praze. Orloj je poprvé historicky doložen v listině z 9. října 1410 dochované v opisu. Orloji uprostřed dominuje … Dolní řada vlevo: Filosof zkoumající svět Archanděl Michael: socha archanděla nejprve svým kopím ukazovala na platný údaj na kalendářní desce, ale od Mánesova pootočení kalendária ukazuje na ukazatel v horní části ciferníku. Dolní řada vpravo: … Orloj Nejstarší částí orloje je mechanický hodinový stroj a astronomický číselník, které vytvořil roku 1410 hodinář Mikuláš z Kadaně, pravděpodobně podle návrhu Mistra Jana Šindela, profesora filosofie, matematiky, astronomie a rektora pražské … 

 3. Pohádkový orloj v Ostravě [score=0.9259]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pohádkový orloj v Ostravě je součást nové přístavby Divadla loutek Ostrava. Na rozdíl od tradičních orlojů neobsahuje astronomický ciferník, ale jen symbol hvězdné oblohy a troje dveře, které ukrývají šest dřevěných pohádkových postav: krále, … 

 4. Pokojový orloj Jana Maška [score=0.9230]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pokojový orloj Jana Maška je unikátní pokojový orloj vyrobený v letech 1924 – 1935. Jeho autorem je technik Vítkovických železáren a amatérský astronom Jan Mašek, který jej v roce 1967 u příležitosti 700. výročí první písemné zmínky o Ostravě … 

 5. Slovenský orloj [score=0.9212]
────────────────────────────────────────────────────────────────────────────────────────────────────
Slovenský orloj je dřevěný orloj a také dřevěná socha, která se nachází v obci Stará Bystrica v okrese Čadca v Žilinskom kraji na severozápadním Slovensku. Historie a popis orloje V rámci rekonstrukce náměstí byl v obci postaven jeden z nejmladších … 

 6. Mistr Hanuš [score=0.9196]
────────────────────────────────────────────────────────────────────────────────────────────────────
Mistr Hanuš, tedy Jan, zvaný Růže ( † po roce 1497 ) byl pražský staroměstský zámečník, hodinář a orlojník Staroměstského orloje. Vstoupil do obecného povědomí hlavně díky Jiráskovým Starým pověstem českým, podle kterých měl být samotným tvůrcem … Rozsah vylepšení není jistý, nicméně o Hanušově zručnosti ještě lépe svědčí to, že sestrojil v 90. letech orloj pro radnici v Jindřichově Hradci, za což dostal slušně zaplaceno. Měl ženu Kateřinu a s ní syna Jakuba a dceru Annu. Předpokládá se, že … Externí odkazy KDO BYL KDO v našich dějinách do roku 1918 Mistr Hanuš orloj nepostavil Mistr Hanuš pražský orloj nesestrojil! I staré české pověsti se pletou... Osoby s nejistým datem narození Osoby s nejistým datem úmrtí Muži Narození v 15. … 

 7. Chmelový orloj [score=0.9196]
────────────────────────────────────────────────────────────────────────────────────────────────────
Chmelový orloj je součástí Chrámu chmele a piva v Žatci. Orloj, jeden ze šesti funkčních orlojů v Česku, je tvořen ocelovou konstrukcí o rozměrech 4 × 7 metrů potaženou měděným plechem. Ideu architekta Chrámu chmele a piva Jiřího Vaníčka … 

 8. Orlice (heraldika) [score=0.9172]
────────────────────────────────────────────────────────────────────────────────────────────────────
Jako orlice se v heraldice rozumí vyobrazení figury orla, který má jednu hlavu, přičemž figura se dvěma hlavami je nazývána orel. Ženský tvar „ orlice“ ( místo ( jednohlavý ) orel ) je zvláštností českého heraldického názvosloví. Zvláštním případem … Související články Orel ( heraldika ) Externí odkazy Heraldická zvířata 

 9. Mariánský sloup (Staroměstské náměstí) [score=0.9167]
────────────────────────────────────────────────────────────────────────────────────────────────────
Spory vyvolal záměr Pražského arcibiskupství, které plánovalo do sloupu umístit pamětní listinu podepsanou také osobami bez významné církevní, společenské či politické funkce, např. Janou Bobošíkovou, Hanou Lipovskou nebo mluvčím Pražského hradu … Úředníci magistrátu kvůli němu hrozili žalobou a během krátké doby nechal magistrát část nápisu a opět bude stát odsekat. To vzbudilo pozornost tuzemských i zahraničních médií, ve kterých se objevil kámen s poškozeným nápisem. V roce 1996 vydala … Prostředkem mělo být především postupné vytlačování českých a odsun židovských obyvatel a jejich nahrazování německým obyvatelstvem, výstavba na volných plochách, rozsáhlé asanace a přestavby města v monumentálním duchu a v neposlední řadě také … Česky to znamená „ Panně Rodičce bez poskvrny prvotní počaté za obhájení a osvobození města zbožný a spravedlivý císař tuto sochu postavil“. Sloup byl celkem vysoký téměř 16 metrů a nesl dvoumetrovou pozlacenou sochu Panny Marie Immaculaty. V … Podoba Immaculaty vycházela z motivu apokalyptické „ ženy oděné sluncem, s měsícem pod nohama a s korunou dvanácti hvězd kolem hlavy“ ( Zj 12,1 ) který byl vykladači často spojován s Pannou Marií a uplatnil se už během španělské reconquisty. … 

10. Orel (heraldika) [score=0.9143]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pod pojmem orel se v české heraldice rozumí vyobrazení orla, který má dvě hlavy, oproti tomu orel s jednou hlavou se nazývá orlice. Jedná se o terminologické specifikum české heraldiky, protože jiné jazyky používají pro odlišení těchto dvou zvířat … Roku 1871 zřízená Německá říše přijala opět jednohlavou verzí, tj. orlici. Galerie Odkazy Reference Související články Orel Orlice ( heraldika ) Externí odkazy Vývoj rakouského orla Heraldická zvířata 

11. Dům U Bílého orla (Rytířská) [score=0.9141]
────────────────────────────────────────────────────────────────────────────────────────────────────
Dům U Bílého orla, někdy zvaný U Vokřínů, je dům čp. 410 na Starém Městě v Praze v Rytířské ulici č. 6. Stojí mezi domy U Beránků a U Machtů. Je chráněn jako kulturní památka České republiky. První zmínka o domu je z roku 1400 a jako majitele uvádí … 

12. Staré Město (Praha) [score=0.9140]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pověsti o českých zvonech. Praha: V. Kotrba, 1926. Reference Související články Staroměstská radnice Staroměstská mostecká věž Staroměstské náměstí Staroměstský orloj Seznam představitelů Starého Města pražského Seznam kulturních památek na Starém … Staré Město pražské se stalo městskou obcí v letech 1232 – 1234. Kolem 30. let 13. století bylo uvnitř Starého města založeno královským lokátorem Eberhardem též Havelské město ( Nové město u sv. Havla ), které až do roku 1287 bylo právně a správně … I nadále však zůstává katastrálním územím. Pověsti Ve věžičce Domu U Kamenného zvonu se nacházel zvonek, na nějž zvonili křesťané na znamení počátku boje s pohany. Na paměť toho byl na roh domu zasazen kamenný zvon. Krutá šlechtična jednou … Spolu s dalšími městy ( Rokycany, Chomutov, Kadaň, Žatec, Louny, Slaný, Beroun, Český Brod, Kouřim, Kolín, Čáslav, Nymburk, Kutná Hora, Jaroměř ), která mu ovšem politicky podléhala, tvořilo tzv. pražský svaz. Městská privilegia Od získání … Řada významných památek je soustředěna kolem Královské cesty vedoucí od Prašné brány ulicí Celetnou, přes Staroměstské náměstí, Karlovou ulicí na Karlův most odkud dále pokračuje přes malostranské území na Pražský hrad. Na území Starého Města se … 

13. Kadaňský orloj [score=0.9139]
────────────────────────────────────────────────────────────────────────────────────────────────────
Kadaňský orloj je umělecké dílo v Kadani na Nábřeží Maxipsa Fíka v prostoru pod Kadaňským hradem. Jedná se o kovovou repliku původního hodinového stroje pražského staroměstského orloje nazvanou „ Pocta Mikulášovi z Kadaně“. Autorem mohutné kované … 

14. Okno (Staroměstská radnice) [score=0.9133]
────────────────────────────────────────────────────────────────────────────────────────────────────
Okno je název pro skleněnou plastiku, která se od roku 1990 nachází v historické budově Staroměstské radnice. Je uměleckým dílem Stanislava Libenského a Jaroslavy Brychtové. Její rozměry činí 8,2 x 7,3 m. Plastika vznikla broušením a tavením … 

15. Dům U Červeného orla (Jilská) [score=0.9132]
────────────────────────────────────────────────────────────────────────────────────────────────────
Dům U Červeného orla je dům čp. 452 na Starém Městě v Praze mezi Jilskou ulicí ( č. 22 ) a Hlavsovou uličkou. Stojí mezi domy U Tří bažantů a U Velryby. Je chráněn jako kulturní památka České republiky. Na místě domu stával románský objekt, který … 
</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Lexical Search</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1102">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>search(<span class="st">"lexical"</span>, <span class="st">"velké staré hodiny pro turisty v Praze"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
15 lexical results for «velké staré hodiny pro turisty v Praze» ﹙44ms﹚

 1. Pražský okruh (rozcestník) [score=16.6882]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pražský okruh označuje objízdné trasy kolem Prahy: Pražský okruh – Dálnice D 0, původně R 1, vnější obchvat města Městský okruh ( Praha ) – vnitroměstský okruh, jehož součástí jsou velké tunelové komplexy a Jižní spojka Staré okruhy z 80. let 20. … 

 2. Chata Kamzík [score=15.9089]
────────────────────────────────────────────────────────────────────────────────────────────────────
Chata Kamzík ( ), ( ), ( ) byla chata, která stála do roku 1980 na Starolesnianskej polaně nedaleko Hrebienka ve Vysokých Tatrách v nadmořské výšce 1295 m. Historie Ján Juraj Rainer, nájemce Starého Smokovce, byl první, kdo objevil výhody … 

 3. Bregarjevo zavetišče na planini Viševnik [score=15.6894]
────────────────────────────────────────────────────────────────────────────────────────────────────
Bregarjevo zavetišče na planini Viševnik je horská chata, útulna nacházející se na Planině Viševnik severovýchodně od Staré Fužiny a severně od Bohinjského jezera v Julských Alpách, ve Slovinsku. Stavení je ve vlastnictví Slovinského horského … 

 4. Hodinová věž (Podgorica) [score=15.1049]
────────────────────────────────────────────────────────────────────────────────────────────────────
Hodinová věž ( též známá pod názvem z turečtiny Sahat - kula ) se nachází v hlavním městě Černé Hory, Podgorica, na místním starém městě ( na náměstí Bećir Bega Osmanagiće ). Věž je čtvercového půdorysu. Vybudována byla z kamene, vznikla v závěru … 

 5. Turista [score=15.0591]
────────────────────────────────────────────────────────────────────────────────────────────────────
Turista ( z francouzského tour, okruh, výlet ) je člověk, který cestuje za zábavou, poučením, sportem či rekreací a vrací se zase do svého stálého bydliště. Cestovní ruch V organizovaném cestovním ruchu je turista klient, který využívá jeho služeb. … 

 6. Jan Bárta (spisovatel) [score=14.6690]
────────────────────────────────────────────────────────────────────────────────────────────────────
Knižní vydání Týden na Slovensku ( cestovní příručka pro turisty, kteří nemají ani mnoho peněz ani mnoho času a přece si chtějí zajeti na Slovensko; Praha, Klub čsl. turistů, 1921 ) Vítěz ( román o panictví; v Praze, Gustav Dubský, 1922 ) Román … 

 7. Bohyně 390 km v hodině [score=13.8048]
────────────────────────────────────────────────────────────────────────────────────────────────────
Bohyně 390 km v hodině byla socha umístěná na karlovském předmostí u Nuselského mostu na Novém Městě v Praze 2. Historie Autorem sochy je Jan Boháč, který ji poprvé veřejnosti představil v červnu 2010 na náplavce pod Rašínovým nábřežím v rámci … 

 8. Muğla [score=13.7939]
────────────────────────────────────────────────────────────────────────────────────────────────────
Mugla ( turecky Muğla, řecky Μούγλα ) je město na jihozápadním pobřeží Turecka, které je hlavním městem stejnojmenné provincie. Historie V starověku bylo toto území obývané Káry, přičemž se dostávalo pod vliv Řeků, kteří zde sídlili na nedalekém … 

 9. Cestovní ruch v Praze [score=13.6552]
────────────────────────────────────────────────────────────────────────────────────────────────────
Cestovní ruch v Praze za rok 2019 Prahu v roce 2019 navštívilo 8 044 324 turistů, z toho 84,6 % tvořili zahraniční návštěvníci a 15,4 % rezidenti z ČR. Pokud jde o počet přenocování v Praze, nejvyšší příčky zaujímali návštěvníci z Německa ( 12,5 % … Cestovní ruch v Praze je jedním z hlavních příjmů tohoto hlavního města. V roce 2018 ji navštívilo 9 milionů turistů, byla 20. nejnavštěvovanějším městem světa a po Londýně, Paříži, Istanbulu a Římě 5. nejnavštěvovanějším městem Evropy. Přibližně … 

10. Arachova [score=13.4334]
────────────────────────────────────────────────────────────────────────────────────────────────────
V roce 1826, během Řecké války za nezávislost zde Řekové, pod vedením Jeorjosa Karaiskakisa porazili tureckou armádu Mustafy beje. Současnost Město je dnes známé svým zimním střediskem, nachází se zde lyžařské centrum, jedno z nejznámějších zimních … 

11. Žiarska chata [score=13.3413]
────────────────────────────────────────────────────────────────────────────────────────────────────
Žiarska chata je vysokohorská chata ve střední části Žiarské doliny v nadmořské výši 1285 m n. m. vzdálena asi 5,2 km od jejího ústí. Je velmi často navštěvována turisty, protože je vynikajícím východiskem na různé túry do oblasti Baníkova a … 

12. Krnsko jezero [score=13.3378]
────────────────────────────────────────────────────────────────────────────────────────────────────
Krnsko jezero je ledovcovo - krasové jezero ve Slovinsku. Je ledovcového původu a leží uprostřed krasové oblasti. Nachází se v nadmořské výšce 1394 m. Leží pod Krnem ( 2244 m ) a Batognicí ( 2164 m ) a v nejužší části je vklíněno mezi Lemež ( 2042 … 

13. Limnigraf na Výtoni [score=13.1861]
────────────────────────────────────────────────────────────────────────────────────────────────────
Limnigraf na Výtoni ( výtoňský vodočet ) je stavba na pražském Rašínově nábřeží, nedaleko vyšehradského železničního mostu, naproti Podskalské celnici. V objektu je umístěn limnigraf – přístroj sloužící k odčítání a zaznamenávání výšky hladiny … 

14. Seznam budov na Malém náměstí [score=13.1629]
────────────────────────────────────────────────────────────────────────────────────────────────────
Na Malém náměstí v pražském Starém městě se v současnosti nachází 14 historických budov z různých období. Toto je jejich seznam. Umístění budov Pro snazší popis lokace budov je v tomto seznamu náměstí rozděleno do tří křídel, západního, východního … 

15. Seznam budov na Ovocném trhu [score=13.1336]
────────────────────────────────────────────────────────────────────────────────────────────────────
Na Ovocném trhu, náměstí ve Starém Městě Pražském, se nachází 14 historických i novodobých budov. Toto jej jejich seznam. Umístění budov Pro snazší popsání pozice budov je v tomto článku náměstí rozděleno na tři křídla oddělená ulicemi, západní ( … 
</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Semantic Search</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1103">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>search(<span class="st">"semantic"</span>, <span class="st">"velké staré hodiny pro turisty v Praze"</span>, model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
15 semantic results for «velké staré hodiny pro turisty v Praze» ﹙541ms﹚

 1. Veřejné osvětlení v Praze [score=0.9282]
────────────────────────────────────────────────────────────────────────────────────────────────────
Na svém webu v dubnu 2017 v nedatovaném článku uvádí, že Praha má v majetku celkem 57 ks věžních hodin, 61 ks veřejných hodin v Pražské památkové rezervaci a další na zbylém území hl. m. Prahy ( celkem 417 ). Pomníky Součástí veřejného osvětlení … Dálkové ovládání zapínacích míst se využívá například v případě, kdy z důvodu mimořádné události ( například nabouraný stožár ) je nutno určité zapínací místo operativně vypnout. V Praze má veřejné osvětlení cca 1500 zapínacích míst, které spíná … Podle namátkových kontrol nesvítivosti, které jsou prováděny jednou měsíčně na náhodně vygenerovaném vzorku cca 900 světelných míst, podíl nesvítících nebo špatně svítících lamp klesl na 0,55 % z celé soustavy a při žádné z kontrol nepřekročil … Veřejné osvětlení v Praze má počátky již ve 14. století. Od ohňů v železných pánvích se vyvíjelo přes louče ( doba Rudolfa II. ), olejové lampy ( začátek 18. století ) a plynové lampy ( 1847 – 1985, znovu od roku 2002 ) až po elektrické osvětlení ( … Tvar ( obdélník, kruh, trojúhelník, čtverec, půlkruh ) označuje příkonovou řadu a barva ( červená, zelená, šedá, černá ) značí světelně technické parametry. Aby byly značky viditelné z úrovně terénu i na vysokých stožárech, mají základní rozměr 70 … 

 2. Brněnský orloj [score=0.9261]
────────────────────────────────────────────────────────────────────────────────────────────────────
Také se řešila patřičnost takto moderního díla v historické zástavbě, různé interpretace tvaru plastiky i obtížnost zjištění času. V roce 2011 brněnský magistrát vytvořil turistické suvenýry ve tvaru této plastiky, 18 cm vysoké. Galerie Odkazy … Vždy v 11.00 po zahrání zvonkohry jedna kulička sjede po drahách do jednoho ze čtyř otvorů, v nichž je možno si ji chytit a odnést jako suvenýr domů. Kuličky jsou ruční práce ze sklárny v Karlově. Objekt má symbolizovat konflikt, vítězství i odvahu … Brněnský orloj je černá kamenná plastika ve tvaru projektilu s hodinovým strojem uvnitř, vypouštějící každý den v 11.00 hodin kuličku. Je umístěna na východní straně náměstí Svobody v centru Brna, před obchodním domem Omega. Vytvořili ji sochaři … 

 3. Patrik Pařízek [score=0.9246]
────────────────────────────────────────────────────────────────────────────────────────────────────
Od roku 2018 pracuje v Národním technickém muzeu v Praze, kde se stal roku 2019 kurátorem strojírenských sbírek. Od roku 2019 se podílí na vzdělávací činnosti Akademie Mozarteum. V roce 2019 spoluzakládal obchod se starožitnostmi Clock Gallery v … Patrik Pařízek ( * 22. srpna 1988 Praha ) je český výtvarník, historik umění, muzejní kurátor a pedagog. Jako doktorand Katedry dějin umění FF Univerzity Palackého v Olomouci se specializoval na umělecko - řemeslné zpracování historických hodin. … 

 4. Mozarteum (Praha) [score=0.9245]
────────────────────────────────────────────────────────────────────────────────────────────────────
Střechy jsou ploché s výjimkou středu, kde je umístěn trojúhelníkový štít. V prostoru vestibulu jsou zachovány některé původní detaily, především kryty topení, zábradlí a osvětlení. Současné využití V současné době sídlo mnoha firem. V přízemí … Mozarteum je činžovní dům, který stojí v Jungmannově ulici číslo 30, v Praze - Novém Městě. Historie Dům Mozarteum stojí na místě dřívějšího klasicistního domu se dvorem. Projekt vypracoval architekt Jan Kotěra v duchu moderního klasicismu pro … 

 5. Staroměstský orloj [score=0.9239]
────────────────────────────────────────────────────────────────────────────────────────────────────
Kolem roku 1470 byla doplněna architektonická a sochařská výzdoba a roku 1490 orloj upravil hodinář mistr Hanuš. V druhé polovině 16. století upravil a zdokonalil Staroměstský orloj Jan Táborský z Klokotské Hory. Další dvě zásadní opravy byly … Externí odkazy Laserová show k 600 letům orloje 9. 10. 2010 ( video ) ( video ) ( video ) ( video ) 600 let Pražského orloje na nových webových stránkách ( web ) Výstava fotografií k 600 letům orloje ( web ) Webové stránky Pražského orloje: ( web ) … U příležitosti 600 let od první zmínky o orloji vyšla 16. června 2010 česká známka v nominální hodnotě 21 Kč. Orloj je zastoupen v koláži významných pražských památek na rubu české pětitisícové bankovky. ČNB vydala 17. března 2010 pamětní stříbrnou … Staroměstský orloj nebo také Pražský orloj jsou středověké astronomické hodiny umístěné na jižní straně věže Staroměstské radnice v Praze. Orloj je poprvé historicky doložen v listině z 9. října 1410 dochované v opisu. Orloji uprostřed dominuje … Tvoří ho dvakrát dvanáct zlacených římských cifer s XII. hodinu nahoře a dole, VI. hodinou vlevo a vpravo. Horní dvanáctka v modrém poli znamená poledne, dolní dvanáctka v černém poli půlnoc. Hlavní rafije je kvůli rovnováze protažena i k opačnému … 

 6. Veřejné hodiny v Praze [score=0.9237]
────────────────────────────────────────────────────────────────────────────────────────────────────
Pouliční veřejné hodiny v Praze jsou tradičně spravovány společně s veřejným osvětlením a slavnostním osvětlením a věžními hodinami. Některé veřejné hodiny však jsou vlastnictvím majitelů budov či komunikací, městských částí, developerů, dopravců … Vyškovská společnost Elekon s. r. o. však ve svých referencích uvádí, že od roku 2009 se ve spolupráci s firmou ELTODO - CITELUM, s. r. o. a magistrátem podílí na celkové revitalizaci veřejných hodin a od roku 2014 zajišťuje správu a údržbu systému … Podle analýzy není jasné, na základě čeho zadavatel jednu zakázku označil za služby a druhou za dodávku, když se jedná o identický předmět plnění - opravu a modernizaci veřejných hodin. Podle vyžádaného výpisu ze zápisu o posouzení a hodnocení … Pavel Donev, vedoucí divize realizace zakázek firmy Eltodo - Citelum, na jaře 2016 uvedl, že každé hodiny mají přijímač a po přijmutí signálu se přetočí, pokud však je signál slabší, může k přetočení dojít s několikaminutovým zpožděním. Jednou za … Tyto hodiny nejsou ve správě městského správce osvětlení, ale jsou spravovány společností JCDecaux. Jejich umisťování nebylo s rozmístěním městských uličních hodin koordinováno, a tudíž jsou v některých lokalitách duplicitní – na téže křižovatce … 

 7. Hodiny na České [score=0.9235]
────────────────────────────────────────────────────────────────────────────────────────────────────
Hodiny na České ulici v Brně jsou vývěsní ciferníkové hodiny na nárožním domě čp. 141 v Joštově ulici, tedy na rohu České ( čo. 31 ) a Joštovy ulice ( čo. 7 ) v historickém středu města. Byly na místo instalovány v roce 1992 na objednávku majitele … 

 8. Sluneční hodiny [score=0.9230]
────────────────────────────────────────────────────────────────────────────────────────────────────
Kvůli těmto nevýhodám jsou populární ciferníky ve tvaru armilární sféry, pak má podobu buď sférických kruhů, nebo nejjednodušeji válce okolo polu. Sluneční hodiny v České republice V České republice je v současné době více než 4 300 slunečních … Dvoje nejstarší jsou od roku 1658 na Studentském nádvoří. O desetiletí mladší pak na Révové nádvoří. Nezajímavější ze slunečních hodin jsou štěrbinové v Astronomické věži. V jižní stěně věže je štěrbina, jíž dovnitř, do Kvadrantové síně, dopadá … Výstavy 2002 ( říjen ) – výstava fotografií Sluneční hodiny z jižních Čech, Hvězdárna a planetárium České Budějovice 2005 ( květen až září ) – výstava s názvem Kouzlo slunečních hodin, Hvězdárna a planetárium v Hradci Králové 2011 ( září až … Sluneční hodiny jsou zařízení pro určování času v závislosti na zdánlivém pohybu Slunce. Sluncem ozařovaný předmět vrhá stín a podle aktuální pozice stínu lze určit čas. Určování času je matematicky odvozeno z kombinace dvou základních pohybů Země … Taktéž archeologické práce prováděné na římském náměstí del Popolo, kde se nachází obelisk egyptského původu ze 12. století př. n. l. o výšce 36 m, odhalily rozsáhlý, urbanisticky pojatý číselník. Evropa prvního tisíciletí Objev polosu ( ukazatele … 

 9. Zpravodaj Společnosti přátel starožitných hodin [score=0.9226]
────────────────────────────────────────────────────────────────────────────────────────────────────
6 / 1988 Zemřel Emanuel Poche, s. 1 / Anežka Šimková – Zdeněk Horský: Chcete si pořídit sluneční hodiny?, s. 1 - 4 / Jiří Janda: Skříňkové hodiny, jejich vznik a vývoj, s. 5 - 10 / V. F.: Zajímavosti z hodinářské oblasti, s. 11 5 / 1986 V. Z.: … Panorama ], s. 4 - 8 ) Stará řada 6 / 1973 [ leden 1974? ] Zdeněk Horský: Krása a složitost slunečních hodin, s. 3 - 12 / Abraham a Sancta Clara: Hodinář ( přeložil Otto F. Babler ), s. 13 - 18 / D. Hníková: Uhren, Das grosse Bilderlexikon der … 30 / 2015 Informace výboru / R. Himmler: Olomoucký orloj odhalen před 60 lety / P. Nekuža: Odborná exkurze SPSH / P. Stöhrová: Hodinky PRIM 1954 – 1994 / R. Himmler: Založen Český spolek horologický / Tabulka závitů ( k tisku připravil V. Černý ) / … 32 / 2017 Úvodní slovo předsedy / Úvodní slovo redaktora / D. Knespl: Orloje ztracené, naštěstí ne úplně. Zaniklé pobaltské orloje ve Wismaru a Lübecku / R. Uher: Zlaté špindlovky se šnekovým vyrovnávačem tahu hnacího pera / L. Hovorka: Budíky s … 35 / 2020 Úvodní slovo předsedy / Petr Král: Eclipsoskop Karla Steinicha a Josefa Hassenteufela z roku 1911 / Patrik Pařízek: Pohyblivé mechanické figury na světských stavbách v České republice / David Knespl: Anaforické hodiny / Ivan Kopecký: … 

10. Hodiny [score=0.9220]
────────────────────────────────────────────────────────────────────────────────────────────────────
Speciální hodiny Kromě toho existuje řada různých časoměrných zařízení pro speciální účely, například: stopky a chronografy na odměřování kratších časových intervalů, různé registrační hodiny jako" píchačky", hlídačské nebo ponocenské hodiny, … Hodiny ( množné číslo slova hodina, z praslovanského godъ výročí, svátek, doba ) jsou přístroje na měření času, obvykle v rámci jednoho dne. Doplňkově může ukazovat i kalendářní údaje. Pokud jsou malé a přenosné, nazývají se hodinky, pro velmi … Podle pohonu a konstrukce se dělí na: Mechanické hodiny, například: stacionární ( nepřenosné ) kyvadlové hodiny, resp. věžní hodiny; přenosné hodiny a Hodinky, obvykle řízené setrvačkou čili „ nepokojem“; námořní a letecké chronometry; elektrické … Hlavní části mechanických hodin Každé mechanické hodiny mají tyto hlavní části: zdroj energie čili pohon, jímž může být závaží, pružina s natahovacím zařízením nebo zdroj proudu; soustavu ozubených převodů, jež přenáší energii od zdroje k … Proto se u hodinek dlouho udržel lihýř, který teprve kolem roku 1700 nahradila setrvačka ( lidově „ nepokoj“, z německého Unruh ). Setrvačka je kolo na hřídeli a direkční sílu vyvozuje vlásek, jemná spirálová pružina. Frekvenci setrvačky ovlivňuje … 

11. Velká zvonice lávry [score=0.9220]
────────────────────────────────────────────────────────────────────────────────────────────────────
Stalo se tak v září 1941, kdy byla nedaleko ležící katedrála ( Nanebevzetí Panny Marie ) zničena silnou explozí armádními silami během druhé světové války. Po opravách, které byly kompletně hotové až v roce 1961, přičemž hodiny začaly fungovat již … Na západ kupříkladu Římskokatolickou katedrálu svatého Mikuláše, Kyjevskou pevnost ( historický památkový komplex ruského opevnění ) a řadu mrakodrapů, nejvyšších budov v zemi; Carnegie Center Tower, Jack House, Parus Business Center či Gulliver. … Velká zvonice lávry ( ukrajinsky Велика Лаврська дзвіниця, rusky Большая Лаврская колокольня, anglicky Great Lavra Bell Tower ), celým názvem Velká zvonice katedrály Nanebevzetí Panny Marie, je neoklasicistní zvonice, dominanta pravoslavného … 1782 – generální oprava s pozlacením 1825 – zhotovena kompletní nová omítka 1879 a 1895 – běžné pravidelné opravy 1894 – původní kovové vstupní dveře nahrazeny novými, avšak identickými, vyrobenými v ateliéru F. Walkera 1919 až 1920 – zvonice byla … Popis Je to cihlová osmiboká čtyřpatrová věž s pozlacenou kupolí, ukončená rovněž zlaceným a 3,75 metrů vysokým křesťanským křížem, díky kterému atakuje výšku 96,52 metrů. Základy ze žulových desek sahají do hloubky větší než 7 metrů. Přízemní část … 

12. Pražský metronom [score=0.9215]
────────────────────────────────────────────────────────────────────────────────────────────────────
Popis Pražský objekt, který autor nazval Stroj času měl svým umístěním na podstavci bývalého Stalinova pomníku rovněž symbolizovat neúprosné plynutí času a varovnou připomínku minulosti. Stroj svým vzhledem připomíná Mälzelův metronom, a ačkoliv … Pražský metronom je kinetický sochařský objekt Vratislava Nováka, instalovaný roku 1991 v místě bývalého Stalinova pomníku v Praze na Letné nad Čechovým mostem. Historie Metronom byl vyroben společností ČKD Racionalizace na objednávku Společnosti … 

13. Pragotron [score=0.9211]
────────────────────────────────────────────────────────────────────────────────────────────────────
Od 23. října 2013 se jediným společníkem stala společnost ELEKON, s. r. o., z Vyškova. Tu vlastní Pavel Novák ( 45 % ) a Blanka Nováková ( 15 % ) z Drnovic a ze 40 % švýcarská firma Moser - Baer Holding AG. Všechny výše uvedené podniky Elektročas i … Pragotron je český výrobní podnik v oboru časoměrné techniky a vizuálních informačních systémů pro cestující. Začal vyrábět v 19. století jako firma Jednotný čas. Několikrát poté ještě změnila svůj název - Elektročas či Pragotron. Dnešní společnost … Pro SŽDC dodává zejména audiovizuální informační systém typu IZE 1, využívající tabule se speciálními transreflexními displeji s tekutými krystaly ( LCD, prosvětlované vestavěným zářivkovým osvětlením, a za displeji je umístěna reflexní fólie, … Od roku 1980 dochází k zásadní modernizaci hlavních hodin na elektronické, tuto řadu zastupovaly prakticky tři typy hodin, EH 1, ESH 3 a ústředny EHU. Tento stav vydržel po celá 80. léta. Kolem přelomu 80. a 90. let se začaly vyrábět hlavní hodiny … Řídicí pult byl na nádražích většinou umístěn v dopravní kanceláři, kde byla i kontrolní tabule, aby měl dispečer přehled o celém zařízení. Dnes se řídící pulty většinou nahrazují počítači, které řídí celý informační systém včetně automatického … 

14. Staroměstská vodárenská věž [score=0.9210]
────────────────────────────────────────────────────────────────────────────────────────────────────
Ing. Robert Kořínek, Ph. D. a Mgr. Petra Kořínková. [ cit. 2018 - 01 - 12 ] Atlas Česka - věž a muzeum Atlas Česka - věžní hodiny Pražská informační služba Hodinové věže v Česku Vodárenské věže v Praze Stavby na Starém Městě ( Praha ) Kulturní … Ve výšce 31 metrů byl ve věži umístěn vodojem, z něhož byla vltavská voda rozváděna samospádem do okolí. Po posledním požáru v letech 1878 – 1888 došlo k novogotické přestavbě, věž byla zvýšena o jedno podlaží, byla doplněna velkým hodinovým … Staroměstská vodárenská věž se nalézá v Praze 1 na Starém Městě pražském na Novotného lávce ( dříve Staroměstská lávka ) na pravém břehu řeky Vltavy v areálu dnešního Muzea Bedřicha Smetany. Věž i budova muzea byly původně součástí staroměstské … 

15. Velikovský dům [score=0.9203]
────────────────────────────────────────────────────────────────────────────────────────────────────
Velikovský dům, také Šternberský či Lázeň, Malá Strana čp. 518, je historický dům na rohu Malostranského náměstí a Tomášské ulice. Původně zde stával gotický měšťanský dům ze 14. století. Po požáru Malé Strany v r. 1541 byl obnoven v pozdně … 
</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<iframe id="word-arithmetics" src="http://127.0.0.1:5000/?q=Které+město+v+České+republice+má+nejvíce+obyvatel%3F&amp;m=e5-base&amp;t=lexical&amp;h=on" width="100%" height="85%">
</iframe>
<div class="footer">
<p><a href="https://wikipedia.karmi.dev/?q=Které+město+v+České+republice+má+nejvíce+obyvatel%3F&amp;m=e5-base&amp;t=lexical&amp;h=on" class="uri">https://wikipedia.karmi.dev/?q=Které+město+v+České+republice+má+nejvíce+obyvatel%3F&amp;m=e5-base&amp;t=lexical&amp;h=on</a></p>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Performance: Inference on CPU</h2>
<p><a href="https://onnxruntime.ai" class="uri">https://onnxruntime.ai</a></p>
<p><a href="https://huggingface.co/docs/optimum/v1.16.2/quicktour" class="uri">https://huggingface.co/docs/optimum/v1.16.2/quicktour</a></p>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="1470">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn.functional <span class="im">as</span> F</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> transformers <span class="im">import</span> AutoTokenizer</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> optimum.onnxruntime <span class="im">import</span> ORTModelForCustomTasks</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> AutoTokenizer.from_pretrained(MODEL_ID)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>model_op <span class="op">=</span> ORTModelForCustomTasks.from_pretrained(MODEL_ID, subfolder<span class="op">=</span><span class="st">"onnx"</span>).to(<span class="st">"cpu"</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> average_pool(last_hidden_states, attention_mask):</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    last_hidden <span class="op">=</span> last_hidden_states.masked_fill(<span class="op">~</span>attention_mask[..., <span class="va">None</span>].<span class="bu">bool</span>(), <span class="fl">0.0</span>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> last_hidden.<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>) <span class="op">/</span> attention_mask.<span class="bu">sum</span>(dim<span class="op">=</span><span class="dv">1</span>)[..., <span class="va">None</span>]</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> encode(<span class="va">self</span>, query):</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> tokenizer([query], max_length<span class="op">=</span><span class="dv">512</span>, padding<span class="op">=</span><span class="va">True</span>, truncation<span class="op">=</span><span class="va">True</span>, return_tensors<span class="op">=</span><span class="st">'pt'</span>)</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>    outputs <span class="op">=</span> <span class="va">self</span>(<span class="op">**</span>inputs)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (F.normalize(average_pool(outputs.last_hidden_state, inputs[<span class="st">'attention_mask'</span>]), p<span class="op">=</span><span class="dv">2</span>, dim<span class="op">=</span><span class="dv">1</span>)).detach().cpu().numpy()[<span class="dv">0</span>]</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>model_op.encode <span class="op">=</span> partial(encode, model_op)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>model_st <span class="op">=</span> model</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"model_st=[</span><span class="sc">{</span>model_st<span class="sc">.</span>_get_name()<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>MODEL_ID<span class="sc">}</span><span class="ss">], device=device=</span><span class="sc">{</span>model<span class="sc">.</span>device<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"model_op=[</span><span class="sc">{</span>model_op<span class="sc">.</span>model_name<span class="sc">}</span><span class="ss">:</span><span class="sc">{</span>MODEL_ID<span class="sc">}</span><span class="ss">], device=</span><span class="sc">{</span>model_op<span class="sc">.</span>device<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>model_st=[SentenceTransformer:intfloat/multilingual-e5-base], device=device=mps:0
model_op=[model.onnx:intfloat/multilingual-e5-base], device=cpu</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Performance: Inference on CPU</h2>
<div class="footer">
<p>➍ Search the Data</p>
</div>
<div class="cell" data-execution_count="608">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>r <span class="dv">100</span> <span class="op">-</span>n <span class="dv">10</span> model_st.encode(query)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>timeit <span class="op">-</span>r <span class="dv">100</span> <span class="op">-</span>n <span class="dv">10</span> model_op.encode(query)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>17.3 ms ± 2.1 ms per loop (mean ± std. dev. of 100 runs, 10 loops each)
3.94 ms ± 90.2 µs per loop (mean ± std. dev. of 100 runs, 10 loops each)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="805">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>embeddings_st <span class="op">=</span> model_st.encode(query)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>embeddings_op <span class="op">=</span> model_op.encode(query)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>diff <span class="op">=</span> np.<span class="bu">abs</span>(embeddings_st <span class="op">-</span> embeddings_op)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> np.printoptions(linewidth<span class="op">=</span><span class="dv">120</span>, threshold<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(embeddings_st, embeddings_op, sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, end<span class="op">=</span><span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"equal (e-10): </span><span class="sc">{</span>np<span class="sc">.</span>allclose(embeddings_st, embeddings_op, atol<span class="op">=</span><span class="fl">1e-10</span>)<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"equal (e-6):  </span><span class="sc">{</span>np<span class="sc">.</span>allclose(embeddings_st, embeddings_op, atol<span class="op">=</span><span class="fl">1e-6</span>)<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"max diff:     </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(diff)<span class="sc">:.0e}</span><span class="ss"> (</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(diff)<span class="sc">:.10f}</span><span class="ss">)"</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"mean diff:    </span><span class="sc">{</span>np<span class="sc">.</span>mean(diff)<span class="sc">:.0e}</span><span class="ss"> (</span><span class="sc">{</span>np<span class="sc">.</span>mean(diff)<span class="sc">:.10f}</span><span class="ss">) ± </span><span class="sc">{</span>np<span class="sc">.</span>std(diff)<span class="sc">:.0e}</span><span class="ss">"</span>,</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f"mismatched:   </span><span class="sc">{</span>np<span class="sc">.</span>count_nonzero(diff)<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(diff)<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    sep<span class="op">=</span><span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 0.00815539  0.02749375  0.00090191 ... -0.02684432 -0.03022929  0.02605095]
[ 0.00815535  0.02749379  0.00090188 ... -0.02684436 -0.03022928  0.0260509 ]

equal (e-10): False
equal (e-6):  True
max diff:     1e-07 (0.0000001076)
mean diff:    3e-08 (0.0000000281) ± 2e-08
mismatched:   746/768</code></pre>
</div>
</div>
</section>
<section class="slide level2">
<h2>➎ Evaluate Search Quality</h2>
<ul>
<li>Standardized metrics: Precision and recall, MRR, (N)DCG, …</li>
<li>Example: compare lexical and semantic search</li>
<li>Ranking Evaluation API</li>
</ul>
</section>
<section class="slide level2 slide-code smaller">
<h2>Evaluation Data</h2>
<p><a href="https://www.elastic.co/blog/made-to-measure-how-to-use-the-ranking-evaluation-api-in-elasticsearch">Made To Measure: How to Use the Ranking Evaluation API in Elasticsearch</a></p>
<div class="footer">
<p>➎ Evaluate Search Quality</p>
</div>
<div class="cell" data-execution_count="1432">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>index_name <span class="op">=</span> <span class="bu">list</span>(es.indices.get_alias(name<span class="op">=</span>INDEX_ALIAS).keys())[<span class="dv">0</span>]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>eval_query <span class="op">=</span> <span class="st">"staroměstský orloj"</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> [</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Staroměstský orloj"</span>,   <span class="st">"rating"</span>: <span class="dv">5</span>, <span class="st">"_id"</span>: <span class="st">"BIVvNo0BaFxnamZUNs28"</span>},</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Orloj"</span>,                <span class="st">"rating"</span>: <span class="dv">4</span>, <span class="st">"_id"</span>: <span class="st">"PYVvNo0BaFxnamZUNsu8"</span>},</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Mistr Hanuš"</span>,          <span class="st">"rating"</span>: <span class="dv">3</span>, <span class="st">"_id"</span>: <span class="st">"i4hvNo0BaFxnamZU4pVD"</span>},</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Mikuláš z Kadaně"</span>,     <span class="st">"rating"</span>: <span class="dv">3</span>, <span class="st">"_id"</span>: <span class="st">"w4hvNo0BaFxnamZUxRxl"</span>},</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Staroměstská radnice"</span>, <span class="st">"rating"</span>: <span class="dv">2</span>, <span class="st">"_id"</span>: <span class="st">"4IZvNo0BaFxnamZUW0bR"</span>},</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Staroměstské náměstí"</span>, <span class="st">"rating"</span>: <span class="dv">2</span>, <span class="st">"_id"</span>: <span class="st">"w4VvNo0BaFxnamZURN6Z"</span>},</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Hodinová věž"</span>,         <span class="st">"rating"</span>: <span class="dv">1</span>, <span class="st">"_id"</span>: <span class="st">"VodvNo0BaFxnamZUwP9w"</span>},</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Jakub Čech (hodinář)"</span>, <span class="st">"rating"</span>: <span class="dv">1</span>, <span class="st">"_id"</span>: <span class="st">"94lwNo0BaFxnamZUJc8z"</span>},</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Cisiojan"</span>,             <span class="st">"rating"</span>: <span class="dv">1</span>, <span class="st">"_id"</span>: <span class="st">"N4VvNo0BaFxnamZUL7sl"</span>},</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Brněnský orloj"</span>,       <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"8ohvNo0BaFxnamZUxR1l"</span>},</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Olomoucký orloj"</span>,      <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"94VvNo0BaFxnamZUReYG"</span>},</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Ostravský orloj"</span>,      <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"PIlwNo0BaFxnamZUJdR3"</span>},</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Pohádkový orloj"</span>,      <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"1IdvNo0BaFxnamZUrK_h"</span>},</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Kadaňský orloj"</span>,       <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"I4pwNo0BaFxnamZUZNjB"</span>},</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Hospodský orloj"</span>,      <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"yIlwNo0BaFxnamZUKeyd"</span>},</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Chmelový orloj"</span>,       <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"JYxwNo0BaFxnamZUy2wx"</span>},</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Ovocný trh (Praha)"</span>,   <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"5YdvNo0BaFxnamZUtdnl"</span>},</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Nábřeží Maxipsa Fíka"</span>, <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"OIpwNo0BaFxnamZUWKow"</span>},</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Očnice"</span>,               <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"oolwNo0BaFxnamZUHsQp"</span>},</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>  {<span class="st">"title"</span>: <span class="st">"Megalit"</span>,              <span class="st">"rating"</span>: <span class="dv">0</span>, <span class="st">"_id"</span>: <span class="st">"qYZvNo0BaFxnamZUSwfS"</span>}]</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="bu">len</span>(ratings)<span class="sc">}</span><span class="ss"> ratings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>20 ratings</code></pre>
</div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Ranking Evaluation API for <em>Normalized Discounted Cumulative Gain</em></h2>
<p><a href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG" class="uri">https://en.wikipedia.org/wiki/Discounted_cumulative_gain#Normalized_DCG</a></p>
<div class="footer">
<p>➎ Evaluate Search Quality</p>
</div>
<div class="cell" data-execution_count="1427">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_evaluation(client, ratings, queries):</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  size <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  requests <span class="op">=</span> []</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="bu">id</span>, query <span class="kw">in</span> queries:</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    query.update({<span class="st">"size"</span>: size})</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    req <span class="op">=</span> {</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"id"</span>: <span class="bu">id</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"request"</span>: query,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"ratings"</span>: [ { <span class="st">"_index"</span>: index_name, <span class="st">"_id"</span>: item[<span class="st">"_id"</span>], <span class="st">"rating"</span>: item[<span class="st">"rating"</span>] } <span class="cf">for</span> item <span class="kw">in</span> ratings ],</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    requests.append(req)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> client.rank_eval(</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>index_name,</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    metric<span class="op">=</span>{ <span class="st">"dcg"</span>: { <span class="st">"k"</span>: size, <span class="st">"normalize"</span>: <span class="va">True</span> } },</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    requests<span class="op">=</span>requests)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="1428">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>query_lexical <span class="op">=</span> {</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"query"</span>: {</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nested"</span>: {</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"path"</span>: <span class="st">"parts"</span>,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"query"</span>: {</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"match"</span>: {</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"parts.chunk"</span>: eval_query,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>        }}}}}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="1429">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>query_semantic <span class="op">=</span> {</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"query"</span>: {</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nested"</span>: {</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"path"</span>: <span class="st">"parts"</span>,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"query"</span>: {</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"knn"</span>: {</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">"field"</span>: <span class="st">"parts.embedding"</span>,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"query_vector"</span>: model.encode(<span class="st">"query: "</span> <span class="op">+</span> eval_query),</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"num_candidates"</span>: <span class="dv">1000</span>,</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>        }}}}}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2 slide-code smaller">
<h2>Display Evaluation Results, <em>Normalized Discounted Cumulative Gain</em></h2>
<div class="footer">
<p>➎ Evaluate Search Quality</p>
</div>
<div class="cell" data-execution_count="1430">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>eval_results <span class="op">=</span> run_evaluation(es, ratings, [(<span class="st">'lexical'</span>, query_lexical), (<span class="st">'semantic'</span>, query_semantic)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="1431">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jinja2 <span class="im">import</span> Template</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">id</span>, res <span class="kw">in</span> eval_results[<span class="st">'details'</span>].items():</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    doc_ids <span class="op">=</span> [hit[<span class="st">'hit'</span>][<span class="st">'_id'</span>] <span class="cf">for</span> hit <span class="kw">in</span> res[<span class="st">'hits'</span>]]</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    docs <span class="op">=</span> es.mget(</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>index_name, ids<span class="op">=</span>doc_ids, source_includes<span class="op">=</span>[<span class="st">'title'</span>, <span class="st">'url'</span>], filter_path<span class="op">=</span>[<span class="st">'docs._id'</span>, <span class="st">'docs._source'</span>]</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    )[<span class="st">'docs'</span>]</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(res[<span class="st">'hits'</span>]): doc.update({</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"title"</span>: docs[i][<span class="st">'_source'</span>][<span class="st">'title'</span>],</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"url"</span>: docs[i][<span class="st">'_source'</span>][<span class="st">'url'</span>],</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>template_data <span class="op">=</span> {</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'eval_query'</span>: eval_query,</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ids'</span>: <span class="bu">list</span>(eval_results[<span class="st">'details'</span>].keys()),</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'results'</span>: eval_results[<span class="st">'details'</span>],</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>template_string <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;table class="eval_results"&gt;</span></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;caption&gt;Query: «</span><span class="sc">{{</span><span class="st"> eval_query </span><span class="sc">}}</span><span class="st">»&lt;/caption&gt;</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;thead&gt;</span></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;tr&gt;</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% f</span><span class="st">or id in ids %}</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;th&gt;&lt;strong&gt;</span><span class="sc">{{</span><span class="st"> id.upper() </span><span class="sc">}}</span><span class="st">&lt;/strong&gt;&lt;/th&gt;</span></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% e</span><span class="st">ndfor %}</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/tr&gt;</span></span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;tr&gt;</span></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% f</span><span class="st">or id, res in results.items() %}</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;th&gt;</span></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;code&gt;</span><span class="sc">{{</span><span class="st"> res['metric_score']|round(2) </span><span class="sc">}}</span><span class="st">&lt;/code&gt; </span><span class="sc">{{</span><span class="st"> res['metric_details']['dcg']['unrated_docs'] </span><span class="sc">}}</span><span class="st"> unrated</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;/th&gt;</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% e</span><span class="st">ndfor %}</span></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/tr&gt;</span></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/thead&gt;</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;tbody&gt;</span></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a><span class="st">        {</span><span class="sc">% f</span><span class="st">or i in range(results[ids[0]]['hits']|length) %}</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;tr&gt;</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% s</span><span class="st">et a = results[ids[0]]['hits'][i] %}</span></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% s</span><span class="st">et b = results[ids[1]]['hits'][i] %}</span></span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% s</span><span class="st">et a_rating = a['rating'] if a['rating'] is not none else '—' %}</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a><span class="st">            {</span><span class="sc">% s</span><span class="st">et b_rating = b['rating'] if b['rating'] is not none else '—' %}</span></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;td&gt;</span></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;small&gt;</span><span class="sc">{{</span><span class="st"> loop.index </span><span class="sc">}}</span><span class="st">.&lt;/small&gt;</span></span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;a href="</span><span class="sc">{{</span><span class="st"> a['url'] </span><span class="sc">}}</span><span class="st">" target="_blank"&gt;</span><span class="sc">{{</span><span class="st"> a['title'] </span><span class="sc">}}</span><span class="st">&lt;/a&gt;</span></span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;code class="r-</span><span class="sc">{{</span><span class="st"> a_rating </span><span class="sc">}}</span><span class="st">"&gt;</span><span class="sc">{{</span><span class="st"> a_rating </span><span class="sc">}}</span><span class="st">&lt;/code&gt;</span></span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;/td&gt;</span></span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;td&gt;</span></span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;small&gt;</span><span class="sc">{{</span><span class="st"> loop.index </span><span class="sc">}}</span><span class="st">.&lt;/small&gt;</span></span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;a href="</span><span class="sc">{{</span><span class="st"> b['url'] </span><span class="sc">}}</span><span class="st">" target="_blank"&gt;</span><span class="sc">{{</span><span class="st"> b['title'] </span><span class="sc">}}</span><span class="st">&lt;/a&gt;</span></span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a><span class="st">                &lt;code class="r-</span><span class="sc">{{</span><span class="st"> b_rating </span><span class="sc">}}</span><span class="st">"&gt;</span><span class="sc">{{</span><span class="st"> b_rating </span><span class="sc">}}</span><span class="st">&lt;/code&gt;</span></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a><span class="st">            &lt;/td&gt;</span></span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;/tr&gt;</span></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a><span class="st">        {</span><span class="sc">% e</span><span class="st">ndfor %}</span></span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;/tbody&gt;</span></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/table&gt;</span></span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>HTML(Template(template_string).render(template_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

</section>
<section id="" class="slide level2 slide-code smaller output-location-slide"><h2>Display Evaluation Results, <em>Normalized Discounted Cumulative Gain</em></h2><div class="cell output-location-slide" data-execution_count="1431">
<div class="cell-output cell-output-display" data-execution_count="1431">


<table class="eval_results" data-quarto-postprocess="true">
<caption>Query: «staroměstský orloj»</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"><strong>SEMANTIC</strong></th>
<th data-quarto-table-cell-role="th"><strong>LEXICAL</strong></th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"><code>0.59</code> 20 unrated</th>
<th data-quarto-table-cell-role="th"><code>0.34</code> 15 unrated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="small">1.</span> <a href="https://cs.wikipedia.org/wiki/Ovocn%C3%BD%20trh%20%28Praha%29" target="_blank">Ovocný trh (Praha)</a> <code class="r-0">0</code></td>
<td><span class="small">1.</span> <a href="https://cs.wikipedia.org/wiki/Kada%C5%88sk%C3%BD%20orloj" target="_blank">Kadaňský orloj</a> <code class="r-0">0</code></td>
</tr>
<tr class="even">
<td><span class="small">2.</span> <a href="https://cs.wikipedia.org/wiki/Starom%C4%9Bstsk%C3%BD%20orloj" target="_blank">Staroměstský orloj</a> <code class="r-5">5</code></td>
<td><span class="small">2.</span> <a href="https://cs.wikipedia.org/wiki/Jakub%20%C4%8Cech%20%28hodin%C3%A1%C5%99%29" target="_blank">Jakub Čech (hodinář)</a> <code class="r-1">1</code></td>
</tr>
<tr class="odd">
<td><span class="small">3.</span> <a href="https://cs.wikipedia.org/wiki/Orloj" target="_blank">Orloj</a> <code class="r-4">4</code></td>
<td><span class="small">3.</span> <a href="https://cs.wikipedia.org/wiki/Poh%C3%A1dkov%C3%BD%20orloj%20v%20Ostrav%C4%9B" target="_blank">Pohádkový orloj v Ostravě</a> <code class="r-0">0</code></td>
</tr>
<tr class="even">
<td><span class="small">4.</span> <a href="https://cs.wikipedia.org/wiki/Poh%C3%A1dkov%C3%BD%20orloj%20v%20Ostrav%C4%9B" target="_blank">Pohádkový orloj v Ostravě</a> <code class="r-0">0</code></td>
<td><span class="small">4.</span> <a href="https://cs.wikipedia.org/wiki/Chmelov%C3%BD%20orloj" target="_blank">Chmelový orloj</a> <code class="r-0">0</code></td>
</tr>
<tr class="odd">
<td><span class="small">5.</span> <a href="https://cs.wikipedia.org/wiki/K%C5%99i%C5%BEovnick%C3%A9%20n%C3%A1m%C4%9Bst%C3%AD" target="_blank">Křižovnické náměstí</a> <code class="r-—">—</code></td>
<td><span class="small">5.</span> <a href="https://cs.wikipedia.org/wiki/Jan%20T%C3%A1borsk%C3%BD%20z%20Klokotsk%C3%A9%20Hory" target="_blank">Jan Táborský z Klokotské Hory</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">6.</span> <a href="https://cs.wikipedia.org/wiki/Chmelov%C3%BD%20orloj" target="_blank">Chmelový orloj</a> <code class="r-0">0</code></td>
<td><span class="small">6.</span> <a href="https://cs.wikipedia.org/wiki/Orloj" target="_blank">Orloj</a> <code class="r-4">4</code></td>
</tr>
<tr class="odd">
<td><span class="small">7.</span> <a href="https://cs.wikipedia.org/wiki/O%C4%8Dnice" target="_blank">Očnice</a> <code class="r-0">0</code></td>
<td><span class="small">7.</span> <a href="https://cs.wikipedia.org/wiki/Ludv%C3%ADk%20Hainz" target="_blank">Ludvík Hainz</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">8.</span> <a href="https://cs.wikipedia.org/wiki/Slovensk%C3%BD%20orloj" target="_blank">Slovenský orloj</a> <code class="r-—">—</code></td>
<td><span class="small">8.</span> <a href="https://cs.wikipedia.org/wiki/Seznam%20osobnost%C3%AD%20Prahy" target="_blank">Seznam osobností Prahy</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">9.</span> <a href="https://cs.wikipedia.org/wiki/Zemsk%C3%A1%20%C5%A1lechta" target="_blank">Zemská šlechta</a> <code class="r-—">—</code></td>
<td><span class="small">9.</span> <a href="https://cs.wikipedia.org/wiki/Mistr%20Hanu%C5%A1" target="_blank">Mistr Hanuš</a> <code class="r-3">3</code></td>
</tr>
<tr class="even">
<td><span class="small">10.</span> <a href="https://cs.wikipedia.org/wiki/Mistr%20Hanu%C5%A1" target="_blank">Mistr Hanuš</a> <code class="r-3">3</code></td>
<td><span class="small">10.</span> <a href="https://cs.wikipedia.org/wiki/Cisiojan" target="_blank">Cisiojan</a> <code class="r-1">1</code></td>
</tr>
<tr class="odd">
<td><span class="small">11.</span> <a href="https://cs.wikipedia.org/wiki/Pokojov%C3%BD%20orloj%20Jana%20Ma%C5%A1ka" target="_blank">Pokojový orloj Jana Maška</a> <code class="r-—">—</code></td>
<td><span class="small">11.</span> <a href="https://cs.wikipedia.org/wiki/N%C3%A1b%C5%99e%C5%BE%C3%AD%20Maxipsa%20F%C3%ADka" target="_blank">Nábřeží Maxipsa Fíka</a> <code class="r-0">0</code></td>
</tr>
<tr class="even">
<td><span class="small">12.</span> <a href="https://cs.wikipedia.org/wiki/Seznam%20budov%20na%20Ovocn%C3%A9m%20trhu" target="_blank">Seznam budov na Ovocném trhu</a> <code class="r-—">—</code></td>
<td><span class="small">12.</span> <a href="https://cs.wikipedia.org/wiki/Pra%C5%BEsk%C3%BD%20poledn%C3%ADk" target="_blank">Pražský poledník</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">13.</span> <a href="https://cs.wikipedia.org/wiki/Hradsk%C3%A1%20soustava" target="_blank">Hradská soustava</a> <code class="r-—">—</code></td>
<td><span class="small">13.</span> <a href="https://cs.wikipedia.org/wiki/Orloj%20v%20Kr%C3%A1sn%C3%A9m%20Lese" target="_blank">Orloj v Krásném Lese</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">14.</span> <a href="https://cs.wikipedia.org/wiki/Star%C3%A9%20M%C4%9Bsto%20%28Praha%29" target="_blank">Staré Město (Praha)</a> <code class="r-—">—</code></td>
<td><span class="small">14.</span> <a href="https://cs.wikipedia.org/wiki/Hodinov%C3%A1%20v%C4%9B%C5%BE" target="_blank">Hodinová věž</a> <code class="r-1">1</code></td>
</tr>
<tr class="odd">
<td><span class="small">15.</span> <a href="https://cs.wikipedia.org/wiki/Vladislav%20Raz%C3%ADm" target="_blank">Vladislav Razím</a> <code class="r-—">—</code></td>
<td><span class="small">15.</span> <a href="https://cs.wikipedia.org/wiki/Starom%C4%9Bstsk%C3%A1%20radnice" target="_blank">Staroměstská radnice</a> <code class="r-2">2</code></td>
</tr>
<tr class="even">
<td><span class="small">16.</span> <a href="https://cs.wikipedia.org/wiki/Starom%C4%9Bstsk%C3%A1%20radnice" target="_blank">Staroměstská radnice</a> <code class="r-2">2</code></td>
<td><span class="small">16.</span> <a href="https://cs.wikipedia.org/wiki/Vojt%C4%9Bch%20Sucharda" target="_blank">Vojtěch Sucharda</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">17.</span> <a href="https://cs.wikipedia.org/wiki/D%C5%AFm%20U%20B%C3%ADl%C3%A9ho%20orla%20%28Ryt%C3%AD%C5%99sk%C3%A1%29" target="_blank">Dům U Bílého orla (Rytířská)</a> <code class="r-—">—</code></td>
<td><span class="small">17.</span> <a href="https://cs.wikipedia.org/wiki/Hv%C4%9Bzdn%C3%BD%20%C4%8Das" target="_blank">Hvězdný čas</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">18.</span> <a href="https://cs.wikipedia.org/wiki/Orel" target="_blank">Orel</a> <code class="r-—">—</code></td>
<td><span class="small">18.</span> <a href="https://cs.wikipedia.org/wiki/%C5%A0indel%20%28rozcestn%C3%ADk%29" target="_blank">Šindel (rozcestník)</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">19.</span> <a href="https://cs.wikipedia.org/wiki/D%C5%AFm%20U%20B%C3%ADl%C3%A9ho%20jednoro%C5%BEce" target="_blank">Dům U Bílého jednorožce</a> <code class="r-—">—</code></td>
<td><span class="small">19.</span> <a href="https://cs.wikipedia.org/wiki/Klokoty" target="_blank">Klokoty</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">20.</span> <a href="https://cs.wikipedia.org/wiki/Okres%20Krem%C5%BEe-venkov" target="_blank">Okres Kremže-venkov</a> <code class="r-—">—</code></td>
<td><span class="small">20.</span> <a href="https://cs.wikipedia.org/wiki/Orloj%20v%20Kry%C5%A1tofov%C4%9B%20%C3%9Adol%C3%AD" target="_blank">Orloj v Kryštofově Údolí</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">21.</span> <a href="https://cs.wikipedia.org/wiki/Seznam%20sbor%C5%AF%20%C4%8Ceskobratrsk%C3%A9%20c%C3%ADrkve%20evangelick%C3%A9" target="_blank">Seznam sborů Českobratrské církve evangelické</a> <code class="r-—">—</code></td>
<td><span class="small">21.</span> <a href="https://cs.wikipedia.org/wiki/Hospodsk%C3%BD%20orloj" target="_blank">Hospodský orloj</a> <code class="r-0">0</code></td>
</tr>
<tr class="even">
<td><span class="small">22.</span> <a href="https://cs.wikipedia.org/wiki/Ostravsk%C3%BD%20orloj" target="_blank">Ostravský orloj</a> <code class="r-0">0</code></td>
<td><span class="small">22.</span> <a href="https://cs.wikipedia.org/wiki/Mikul%C3%A1%C5%A1%20z%20Kadan%C4%9B" target="_blank">Mikuláš z Kadaně</a> <code class="r-3">3</code></td>
</tr>
<tr class="odd">
<td><span class="small">23.</span> <a href="https://cs.wikipedia.org/wiki/D%C5%AFm%20U%20%C4%8Cerven%C3%A9ho%20orla%20%28Jilsk%C3%A1%29" target="_blank">Dům U Červeného orla (Jilská)</a> <code class="r-—">—</code></td>
<td><span class="small">23.</span> <a href="https://cs.wikipedia.org/wiki/Josef%20M%C3%A1nes" target="_blank">Josef Mánes</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">24.</span> <a href="https://cs.wikipedia.org/wiki/Borrelia" target="_blank">Borrelia</a> <code class="r-—">—</code></td>
<td><span class="small">24.</span> <a href="https://cs.wikipedia.org/wiki/Jan%20%C5%A0indel" target="_blank">Jan Šindel</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">25.</span> <a href="https://cs.wikipedia.org/wiki/Okno%20%28Starom%C4%9Bstsk%C3%A1%20radnice%29" target="_blank">Okno (Staroměstská radnice)</a> <code class="r-—">—</code></td>
<td><span class="small">25.</span> <a href="https://cs.wikipedia.org/wiki/Olomouck%C3%BD%20orloj" target="_blank">Olomoucký orloj</a> <code class="r-0">0</code></td>
</tr>
<tr class="even">
<td><span class="small">26.</span> <a href="https://cs.wikipedia.org/wiki/Megalit" target="_blank">Megalit</a> <code class="r-0">0</code></td>
<td><span class="small">26.</span> <a href="https://cs.wikipedia.org/wiki/Z%C3%A1%C5%99%C3%AD%202018" target="_blank">Září 2018</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">27.</span> <a href="https://cs.wikipedia.org/wiki/Dvoupoln%C3%AD%20syst%C3%A9m" target="_blank">Dvoupolní systém</a> <code class="r-—">—</code></td>
<td><span class="small">27.</span> <a href="https://cs.wikipedia.org/wiki/Star%C3%A9%20M%C4%9Bsto%20%28Praha%29" target="_blank">Staré Město (Praha)</a> <code class="r-—">—</code></td>
</tr>
<tr class="even">
<td><span class="small">28.</span> <a href="https://cs.wikipedia.org/wiki/Podkon%C3%AD%20a%20%C5%BE%C3%A1k" target="_blank">Podkoní a žák</a> <code class="r-—">—</code></td>
<td><span class="small">28.</span> <a href="https://cs.wikipedia.org/wiki/Emilie%20Pali%C4%8Dkov%C3%A1" target="_blank">Emilie Paličková</a> <code class="r-—">—</code></td>
</tr>
<tr class="odd">
<td><span class="small">29.</span> <a href="https://cs.wikipedia.org/wiki/Seznam%20budov%20na%20Starom%C4%9Bstsk%C3%A9m%20n%C3%A1m%C4%9Bst%C3%AD" target="_blank">Seznam budov na Staroměstském náměstí</a> <code class="r-—">—</code></td>
<td><span class="small">29.</span> <a href="https://cs.wikipedia.org/wiki/Ostravsk%C3%BD%20orloj" target="_blank">Ostravský orloj</a> <code class="r-0">0</code></td>
</tr>
<tr class="even">
<td><span class="small">30.</span> <a href="https://cs.wikipedia.org/wiki/Seznam%20sladkovodn%C3%ADch%20ryb%20Evropy" target="_blank">Seznam sladkovodních ryb Evropy</a> <code class="r-—">—</code></td>
<td><span class="small">30.</span> <a href="https://cs.wikipedia.org/wiki/Starom%C4%9Bstsk%C3%BD%20orloj" target="_blank">Staroměstský orloj</a> <code class="r-5">5</code></td>
</tr>
</tbody>
</table>
</div>
</div></section><section class="slide level2 center center-horizontal final" data-background="black">
<h2>Thank you!</h2>
<p><small> With special thanks to <a href="https://github.com/josefslerka">Josef Šlerka</a>, <a href="https://github.com/honzakral">Honza Král</a> and <a href="https://github.com/thonic">Antonín Hoskovec</a>! </small></p>
<div class="footer">
<p>Made with <a href="https://quarto.org"><strong>Quarto</strong></a></p>
</div>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="wikipedia-semantic-search_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: false,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'fast',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
              // target, if specified
              link.setAttribute("target", "_blank");
          }
        }
    });
    </script>
    

</body></html>